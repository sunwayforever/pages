<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-25 二 15:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unicode</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="孙伟" />
<link rel="stylesheet" type="text/css" href="/main.css" media="screen" />
<link rel = "icon" href = "/icon.png"  type = "image/x-icon">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Unicode</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org71deb38">1. Unicode</a>
<ul>
<li><a href="#org2b1275d">1.1. Charset</a></li>
<li><a href="#org36cf7ad">1.2. Encoding</a></li>
<li><a href="#orgfe5a5da">1.3. UTF-16</a>
<ul>
<li><a href="#org692370d">1.3.1. the UTF-16 encoding</a></li>
</ul>
</li>
<li><a href="#org1cab34a">1.4. UTF-8</a>
<ul>
<li><a href="#org3f24ccd">1.4.1. the UTF-8 encoding</a></li>
</ul>
</li>
<li><a href="#org68ebdcb">1.5. Unicode and Java</a></li>
</ul>
</li>
<li><a href="#org45aa7b0">2. ICU</a>
<ul>
<li><a href="#orge7bc92f">2.1. Collator</a></li>
<li><a href="#org7332f34">2.2. Normalizer</a></li>
<li><a href="#org324ca74">2.3. BIDI</a></li>
</ul>
</li>
<li><a href="#orgc498921">3. Reference</a></li>
</ul>
</div>
</div>

<div id="outline-container-org71deb38" class="outline-2">
<h2 id="org71deb38"><span class="section-number-2">1</span> Unicode</h2>
<div class="outline-text-2" id="text-1">
<p>
Representing text-format data in computers is a matter of:
</p>
<ol class="org-ol">
<li>repertoires: defining a set of characters
defining a repertoires of an <b>unordered</b> collection of characters</li>
<li>charset: assigning each character of the repertoires a number (code point)
a coded character set (charset) maps characters from the repertoires to numeric values</li>
<li>encoding: assigning the number a bit representation</li>
</ol>

<p>
thus, we should tell `charset` and `encoding` apart when talking about
text-format data. but for some simple text-format like ASCII, the two concepts
are basically the same: ASCII is both a charset and an encoding scheme
</p>
</div>

<div id="outline-container-org2b1275d" class="outline-3">
<h3 id="org2b1275d"><span class="section-number-3">1.1</span> Charset</h3>
<div class="outline-text-3" id="text-1-1">
<p>
ASCII uses 7 bit to encode 128 characters.
LATIN-1 uses 8 bit to encode 256 characters.
</p>

<p>
Unicode is a <b>charset</b>, so when we talking about unicode, temporary forget the
encoding schemes like `utf`, `ucs`&#x2026;
</p>

<p>
The first version of unicode used 16-bit code points, which allowed for
encoding 65536 characters.
</p>

<p>
Starting with unicode 2.0, the Unicode standard began assigning code points
from 0-10ffff (which requires 21 bits)
</p>

<p>
The first 128 characters of unicode is assigned to the same characters in ASCII
charset, and the same is true for LATIN-1, thus ASCII and LATIN-1 are subsets
of unicode.  Note that we are talking about `charset`, for various encoding 
schemes, MAYBE the conclusion doesn't apply.
</p>
</div>
</div>


<div id="outline-container-org36cf7ad" class="outline-3">
<h3 id="org36cf7ad"><span class="section-number-3">1.2</span> Encoding</h3>
<div class="outline-text-3" id="text-1-2">
<p>
unicode assigns characters a number from 0-10ffff, such a character number is
called a `code point`, these `code point` are just non-negative integer, they
don't have an implicit binary representation or a width of 21 bits &#x2013; binary
representation and unit width is defined by encoding scheme.
</p>

<p>
there are 3 encoding schemes:
</p>
<ol class="org-ol">
<li>UTF-16, the default encoding scheme, map code point to either one or two
16-bit integers</li>
<li>UTF-8 offer backward compatibility with ASCII-based APIs and protocols<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>, A
code pointer is mapped to 1,2,3 or 4 bytes.</li>
<li>UTF-32 is the simplest but most memory intensive encoding: it use a fixed 32
bits integer to map a code point.</li>
</ol>

<p>
Both UTF-16 and UTF-8 are variable length encoding schemes.
</p>

<p>
for input/output, encoding scheme need to define a byte serialization of
text. UTF-8 is itself serializable because it is byte-based. for each of UTF-16
and UTF-32, there are two variants defined: big endian and little endian , the
corresponding encoding scheme is called UTF-16BE, UTF-16LE, UTF-32BE, UTF-32LE.
</p>

<p>
For historical reasons, there are also another two encoding schemes:
</p>
<ol class="org-ol">
<li><p>
UCS2
</p>

<p>
UCS2 is basically the same with UTF-16 of the first unicode version: it is a
fixed length encoding scheme, using 16 bits to encoding code points between
0-ffff, it is deprecated because it can't encode code points between
10000-10ffff
</p></li>

<li><p>
UCS4
</p>

<p>
UCS4 is the same with UTF-32
</p></li>
</ol>
</div>
</div>

<div id="outline-container-orgfe5a5da" class="outline-3">
<h3 id="orgfe5a5da"><span class="section-number-3">1.3</span> UTF-16</h3>
<div class="outline-text-3" id="text-1-3">
<p>
UTF-16 is the default encoding form of Unicode. it is a variable length
encoding scheme: 
</p>
<ul class="org-ul">
<li>for code points between 0-ffff (Basic Multilingual Plane, BMP), UTF-16 using one
16-bit unit to encode</li>
<li><p>
for code points between 10000-10ffff (Supplementary Multilingual Plane, SMP),
UTF-16 using two 16-bit unit to encode code points between 10000-10ffff, are
encoded with two code units, called `surrogates pair`, the first surrogates in
the pair must be in the range of D800-DBFF, and the second one must be in the
range of DC00-DFFF, The coide point values D800-DFFF are just set aside for
this mechanism and will never, by themselves, be assigned any characters.
</p>

<p>
For historical reason, sometimes UCS2 is taken for UTF-16. e.g. JAVA alleged
that a char represent a UTF-16 character, in face, JAVA is using the older
UTF-16 , or the deprecated UCS2, thus a char in JAVA can't represent code
point between 10000-10FFFF!
</p></li>
</ul>
</div>

<div id="outline-container-org692370d" class="outline-4">
<h4 id="org692370d"><span class="section-number-4">1.3.1</span> the UTF-16 encoding</h4>
<div class="outline-text-4" id="text-1-3-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> supplementary code points (10000-10ffff)</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">lead\tail</th>
<th scope="col" class="org-left">DC00</th>
<th scope="col" class="org-left">DC01</th>
<th scope="col" class="org-left">&#x2026;</th>
<th scope="col" class="org-left">DFFF</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">D800</td>
<td class="org-left">10000</td>
<td class="org-left">10001</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">103ff</td>
</tr>

<tr>
<td class="org-left">D801</td>
<td class="org-left">10400</td>
<td class="org-left">10401</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">107ff</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>

<tr>
<td class="org-left">DBFF</td>
<td class="org-left">10fc00</td>
<td class="org-left">10fc01</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">10ffff</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org1cab34a" class="outline-3">
<h3 id="org1cab34a"><span class="section-number-3">1.4</span> UTF-8</h3>
<div class="outline-text-3" id="text-1-4">
<p>
To meet the requirement of bye-oriented, ASCII-based system, the unicode
defines UTF-8, UTF-8 is a variable-width encoding scheme. UTF-8 will encode
character to 1,2,3 or 4 bytes.
</p>
</div>

<div id="outline-container-org3f24ccd" class="outline-4">
<h4 id="org3f24ccd"><span class="section-number-4">1.4.1</span> the UTF-8 encoding</h4>
<div class="outline-text-4" id="text-1-4-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> UHF-8 encoding</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Bits</th>
<th scope="col" class="org-left">Last code point</th>
<th scope="col" class="org-right">Byte 1</th>
<th scope="col" class="org-left">Byte 2</th>
<th scope="col" class="org-left">Byte 3</th>
<th scope="col" class="org-left">Byte 4</th>
<th scope="col" class="org-left">Byte 5</th>
<th scope="col" class="org-left">Byte 6</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">7</td>
<td class="org-left">U+007F</td>
<td class="org-right">0xxxxxxx</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-left">U+07FF</td>
<td class="org-right">110xxxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">16</td>
<td class="org-left">U+FFFF</td>
<td class="org-right">1110xxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">21</td>
<td class="org-left">U+1FFFFF</td>
<td class="org-right">11110xxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">10xxxxxx</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">26</td>
<td class="org-left">&#x2026;</td>
<td class="org-right">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">&#x2026;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
What we can read from this table:
</p>
<ol class="org-ol">
<li>UTF-8 is compilable with ASCII and thus compilable with those legacy
ASCII-based systems</li>
<li>UTF-8 is a prefix<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup> encoding scheme</li>
<li>4 bytes UTF-8 is enough to encode all the 21 bit unicode code points.</li>
<li>Characters U+0800 through U+FFFF use three bytes in UTF-8, but only two in
UTF-16. As a result, text in (for example) Chinese, Japanese or Hindi could
take more space in UTF-8</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org68ebdcb" class="outline-3">
<h3 id="org68ebdcb"><span class="section-number-3">1.5</span> Unicode and Java</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Java internally use UTF-16 to represent `Character` and `String`, BUT, since
UTF-16 is a variable-width encoding, How to represent a SMP UTF-16 using Java
`Character` class?
</p>

<p>
In fact, `Character` literal can only represent UCS2 code units, i.e. they are limited to
values from 0000-ffff, supplementary characters (10000-10ffff) must be
represented as a surrogates pair within a char sequence or as in integer.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #b58900;">char</span> <span style="color: #268bd2;">c</span>=<span style="color: #2aa198;">'\u1234'</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">ok</span>
<span style="color: #b58900;">char</span> <span style="color: #268bd2;">c</span>=<span style="color: #2aa198;">'\u10001'</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">error</span>
<span style="color: #b58900;">String</span> <span style="color: #268bd2;">s</span>=<span style="color: #2aa198;">"\u10001"</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">error</span>
<span style="color: #b58900;">String</span> <span style="color: #268bd2;">s</span>=<span style="color: #2aa198;">"\ud801\ud802"</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">ok</span>
<span style="color: #b58900;">char</span> [] <span style="color: #268bd2;">chars</span>=Character.toChars<span style="color: #757575;">(</span>0x10001<span style="color: #757575;">)</span>;<span style="color: #586e75;">// </span><span style="color: #586e75;">ok</span>
</pre>
</div>

<p>
Java String class and Character class has a lot of methods to cope with code
point, especially for supplementary characters, when dealing with supplementary
characters, we must take care.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #b58900;">String</span> <span style="color: #268bd2;">s</span>=<span style="color: #859900;">new</span> <span style="color: #b58900;">String</span><span style="color: #757575;">(</span><span style="color: #859900;">new</span> <span style="color: #b58900;">int</span>[] <span style="color: #757575;">{</span>0x10001<span style="color: #757575;">},</span>0<span style="color: #757575;">,</span>1<span style="color: #757575;">)</span>;
System.out.println<span style="color: #757575;">(</span><span style="color: #2aa198;">"s.length:"</span>+s.length<span style="color: #757575;">())</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">output: 2</span>
<span style="color: #859900;">for</span> <span style="color: #757575;">(</span><span style="color: #b58900;">int</span> <span style="color: #268bd2;">i</span>=0;i&lt;s.<span style="color: #b58900;">length</span><span style="color: #757575;">()</span>;++i<span style="color: #757575;">)</span> <span style="color: #757575;">{</span>
    System.out.printf<span style="color: #757575;">(</span><span style="color: #2aa198;">"cp: 0x%x\n"</span><span style="color: #757575;">,</span>s.codePointAt<span style="color: #757575;">(</span>i<span style="color: #757575;">))</span>;
<span style="color: #757575;">}</span>
<span style="color: #586e75;">// </span><span style="color: #586e75;">output: 0x10001</span>
<span style="color: #586e75;">//         </span><span style="color: #586e75;">0xdc01</span>
System.out.println<span style="color: #757575;">(</span><span style="color: #2aa198;">"cp count:"</span>+s.codePointCount<span style="color: #757575;">())</span>; <span style="color: #586e75;">// </span><span style="color: #586e75;">output: 1</span>

<span style="color: #b58900;">boolean</span> Character.<span style="color: #268bd2;">isHighSurrogate</span><span style="color: #757575;">(</span><span style="color: #b58900;">char</span> <span style="color: #268bd2;">c</span><span style="color: #757575;">)</span>;
<span style="color: #b58900;">boolean</span> Character.<span style="color: #268bd2;">isLowSurrogate</span><span style="color: #757575;">(</span><span style="color: #b58900;">char</span> <span style="color: #268bd2;">c</span><span style="color: #757575;">)</span>;
<span style="color: #b58900;">int</span> Character.<span style="color: #268bd2;">toCodePoint</span><span style="color: #757575;">(</span><span style="color: #b58900;">char</span> <span style="color: #268bd2;">high</span><span style="color: #757575;">,</span> <span style="color: #b58900;">char</span> <span style="color: #268bd2;">low</span><span style="color: #757575;">)</span>;
<span style="color: #b58900;">char</span> [] Character.<span style="color: #268bd2;">toChars</span><span style="color: #757575;">(</span><span style="color: #b58900;">int</span> <span style="color: #268bd2;">codePoint</span><span style="color: #757575;">)</span>;

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org45aa7b0" class="outline-2">
<h2 id="org45aa7b0"><span class="section-number-2">2</span> ICU</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orge7bc92f" class="outline-3">
<h3 id="orge7bc92f"><span class="section-number-3">2.1</span> Collator</h3>
</div>

<div id="outline-container-org7332f34" class="outline-3">
<h3 id="org7332f34"><span class="section-number-3">2.2</span> Normalizer</h3>
</div>

<div id="outline-container-org324ca74" class="outline-3">
<h3 id="org324ca74"><span class="section-number-3">2.3</span> BIDI</h3>
</div>
</div>

<div id="outline-container-orgc498921" class="outline-2">
<h2 id="orgc498921"><span class="section-number-2">3</span> Reference</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><a href="http://www.unicode.org/charts/unihan.html">Unihan Data Lookup Tool</a></li>
<li><a href="http://en.wikipedia.org/wiki/Unicode">Wikipedia:Unicode</a></li>
<li><a href="http://www.unicode.org/">Unicode Consortium</a></li>
<li><a href="http://cldr.unicode.org/">Unicode CLDR</a></li>
<li><a href="http://site.icu-project.org/">ICU Project</a></li>
<li><a href="http://www.unicode.org/reports/tr10/">UCA:Unicode Collation Algorithm</a></li>
<li><a href="http://userguide.icu-project.org/unicode">Unicode Basic from ICU</a></li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
ASCII-base system will take 0x0 as the `end of data` mark, e.g. `char * `
in C, while UTF-8 encoding scheme doesn't use 0x0 as code unit. 
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
A prefix code is a type of code system (typical a variable-length code)
that there is no valid code word in the system that is a prefix (start) of any
other valid code word in the set. For example, a code with code words {9, 59,
55} has the prefix property; a code consisting of {9, 5, 59, 55} does
not. <a href="http://en.wikipedia.org/wiki/Prefix_code">Wikipedia: prefix code</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: <br />
Last updated: 2021-11-01 一 10:37</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
         var d = document, s = d.createElement('script');
         s.src = '//sunwayforever-github-io.disqus.com/embed.js';
         s.setAttribute('data-timestamp', +new Date());
         (d.head || d.body).appendChild(s);
         })();
</script>
</div>
</body>
</html>
