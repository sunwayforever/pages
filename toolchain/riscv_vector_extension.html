<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>RISC-V Vector Extension</title>

<link rel="stylesheet" type="text/css" href="/main.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../main.css" media="screen" />
<link rel="stylesheet" type="text/css" href="./main.css" media="screen" />
<link rel = "icon" href = "/icon.png"  type = "image/x-icon">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">RISC-V Vector Extension</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org000001c">1. RISC-V Vector Extension</a>
<ul>
<li><a href="#org0000010">1.1. setup testbed</a>
<ul>
<li><a href="#org000000c">1.1.1. setup env</a></li>
<li><a href="#org000000d">1.1.2. build and run</a></li>
</ul>
</li>
<li><a href="#org0000013">1.2. rvv 1.0</a></li>
<li><a href="#org0000016">1.3. gcc rvv intrinsic</a></li>
<li><a href="#org0000019">1.4. gcc rvv auto vectorization</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org000001c" class="outline-2">
<h2 id="org000001c"><span class="section-number-2">1</span> RISC-V Vector Extension</h2>
<div class="outline-text-2" id="text-1">
<p>
当前最新的 rvv (risc-v vector extention) 是 rvv 1.0
</p>
</div>

<div id="outline-container-org0000010" class="outline-3">
<h3 id="org0000010"><span class="section-number-3">1.1</span> setup testbed</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org000000c" class="outline-4">
<h4 id="org000000c"><span class="section-number-4">1.1.1</span> setup env</h4>
<div class="outline-text-4" id="text-1-1-1">
</div>
<div id="outline-container-org0000000" class="outline-5">
<h5 id="org0000000"><span class="section-number-5">1.1.1.1</span> gcc</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<p>
<a href="https://github.com/riscv-collab/riscv-gnu-toolchain">https://github.com/riscv-collab/riscv-gnu-toolchain</a>
</p>

<p>
riscv-gcc 的 riscv-gcc-rvv-next 分支 和 riscv-binutils 的 riscv-binutils-2.38 分支看起来支持 rvv 1.0
</p>
</div>
</div>

<div id="outline-container-org0000003" class="outline-5">
<h5 id="org0000003"><span class="section-number-5">1.1.1.2</span> llvm</h5>
<div class="outline-text-5" id="text-1-1-1-2">
<p>
llvm upsteam 支持 rvv 1.0
</p>
</div>
</div>

<div id="outline-container-org0000006" class="outline-5">
<h5 id="org0000006"><span class="section-number-5">1.1.1.3</span> qemu</h5>
<div class="outline-text-5" id="text-1-1-1-3">
<p>
qemu upstream 支持 rvv 1.0, 默认配置下需要运行时通过 `qemu-riscv64 -cpu
rv64,v=true` 打开 rvv 支持
</p>
</div>
</div>

<div id="outline-container-org0000009" class="outline-5">
<h5 id="org0000009"><span class="section-number-5">1.1.1.4</span> spike</h5>
<div class="outline-text-5" id="text-1-1-1-4">
<p>
spike 支持 rvv 1.0
</p>
</div>
</div>
</div>

<div id="outline-container-org000000d" class="outline-4">
<h4 id="org000000d"><span class="section-number-4">1.1.2</span> build and run</h4>
<div class="outline-text-4" id="text-1-1-2">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;riscv_vector.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>

<span class="org-type">void</span> <span class="org-function-name">vec_add_rvv</span>(<span class="org-type">int</span> *<span class="org-variable-name">a</span>, <span class="org-type">int</span> *<span class="org-variable-name">b</span>, <span class="org-type">int</span> *<span class="org-variable-name">c</span>, <span class="org-type">size_t</span> <span class="org-variable-name">n</span>) {
    <span class="org-type">size_t</span> <span class="org-variable-name">vl</span>;
    <span class="org-type">vint32m2_t</span> <span class="org-variable-name">va</span>, <span class="org-variable-name">vb</span>, <span class="org-variable-name">vc</span>;
    <span class="org-keyword">for</span> (; vl = vsetvl_e32m2(n); n -= vl) {
        vb = vle32_v_i32m2(b, 32);
        vc = vle32_v_i32m2(c, 32);
        va = vadd_vv_i32m2(vb, vc, 32);
        vse32_v_i32m2(a, va, 32);
        a += vl;
        b += vl;
        c += vl;
    }
}

<span class="org-type">int</span> <span class="org-variable-name">x</span>[10] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 0};
<span class="org-type">int</span> <span class="org-variable-name">y</span>[10] = {0, 9, 8, 7, 6, 5, 4, 3, 2, 1};
<span class="org-type">int</span> <span class="org-variable-name">z</span>[10];

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
    <span class="org-type">int</span> <span class="org-variable-name">i</span>;
    vec_add_rvv(z, x, y, 10);
    <span class="org-keyword">for</span> (i = 0; i &lt; 10; i++) printf(<span class="org-string">"%d "</span>, z[i]);
    printf(<span class="org-string">"\n"</span>);
    <span class="org-keyword">return</span> 0;
}
</pre>
</div>

<pre class="example" id="org000000f">
$&gt; /opt/riscv-rvv/bin/riscv64-unknown-linux-gnu-gcc test.c -march=rv64gv -static
$&gt; /opt/riscv-rvv/bin/spike --isa=RV64GCV /opt/riscv-rvv/riscv64-unknown-elf/bin/pk64 a.out
bbl loader
1 11 11 11 11 11 11 11 11 1 
</pre>
</div>
</div>
</div>

<div id="outline-container-org0000013" class="outline-3">
<h3 id="org0000013"><span class="section-number-3">1.2</span> rvv 1.0</h3>
</div>

<div id="outline-container-org0000016" class="outline-3">
<h3 id="org0000016"><span class="section-number-3">1.3</span> gcc rvv intrinsic</h3>
</div>

<div id="outline-container-org0000019" class="outline-3">
<h3 id="org0000019"><span class="section-number-3">1.4</span> gcc rvv auto vectorization</h3>
</div>
</div>



<div id="outline-container-org000001f" class="outline-2 references">
<h2 id="org000001f">Backlinks</h2>
<div class="outline-text-2" id="text-org000001f">
<p>
<a href="riscv_tutorial.html#ID-653c6b58-7ee1-4e07-bf3f-d5eea450748e">RISC-V Tutorial</a>
(<i>RISC-V Tutorial &gt; Standard Extention &gt; RV32V</i>):  <a href="riscv_vector_extension.html#ID-1a3f764a-c401-4233-bd66-f809ada336f1">RISC-V Vector Extension</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: 2022-04-28 Thu 19:05<br />
Last updated: 2022-04-28 Thu 20:20</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
         var d = document, s = d.createElement('script');
         s.src = '//sunwayforever-github-io.disqus.com/embed.js';
         s.setAttribute('data-timestamp', +new Date());
         (d.head || d.body).appendChild(s);
         })();
</script>
</div>
</body>
</html>
