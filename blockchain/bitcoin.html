<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-19 三 12:58 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bitcoin</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="孙伟" />
<link rel="stylesheet" type="text/css" href="/main.css" media="screen" />
<link rel = "icon" href = "/icon.png"  type = "image/x-icon">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Bitcoin</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org28226b2">1. Quick Glossary</a></li>
<li><a href="#orga44c104">2. Cryptography &amp; Cryptocurrency</a></li>
<li><a href="#org8dd1dfa">3. Introduction of Bitcoin</a></li>
<li><a href="#org9ed8835">4. How Bitcoin Works</a></li>
<li><a href="#orgbe2ae27">5. Transactions</a></li>
<li><a href="#org80ac3dc">6. The Block</a></li>
<li><a href="#orga0b479f">7. The Blockchain</a></li>
<li><a href="#orgd9833dd">8. Mining and Consensus</a></li>
<li><a href="#org1178282">9. The Bitcoin Network</a></li>
<li><a href="#orgb066577">10. The future of bitcoin (Blockchain)</a></li>
<li><a href="#org413a397">11. Appendix</a></li>
</ul>
</div>
</div>

<div id="outline-container-org28226b2" class="outline-2">
<h2 id="org28226b2"><span class="section-number-2">1</span> Quick Glossary</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org94108ac" class="outline-3">
<h3 id="org94108ac"><span class="section-number-3">1.1</span> address</h3>
</div>

<div id="outline-container-orga8a65c0" class="outline-3">
<h3 id="orga8a65c0"><span class="section-number-3">1.2</span> bitcoin</h3>
</div>

<div id="outline-container-org92e58aa" class="outline-3">
<h3 id="org92e58aa"><span class="section-number-3">1.3</span> block</h3>
</div>

<div id="outline-container-org2b2acd4" class="outline-3">
<h3 id="org2b2acd4"><span class="section-number-3">1.4</span> blockchain</h3>
</div>

<div id="outline-container-org3f729fe" class="outline-3">
<h3 id="org3f729fe"><span class="section-number-3">1.5</span> coinbase transaction</h3>
</div>

<div id="outline-container-org16b5a5a" class="outline-3">
<h3 id="org16b5a5a"><span class="section-number-3">1.6</span> consensus</h3>
</div>

<div id="outline-container-orgf97de3a" class="outline-3">
<h3 id="orgf97de3a"><span class="section-number-3">1.7</span> difficulty</h3>
</div>

<div id="outline-container-orgdfab4a3" class="outline-3">
<h3 id="orgdfab4a3"><span class="section-number-3">1.8</span> difficulty retargeting</h3>
</div>

<div id="outline-container-org19911a9" class="outline-3">
<h3 id="org19911a9"><span class="section-number-3">1.9</span> exponential distribution</h3>
</div>

<div id="outline-container-org5c69d79" class="outline-3">
<h3 id="org5c69d79"><span class="section-number-3">1.10</span> fee</h3>
</div>

<div id="outline-container-org563df45" class="outline-3">
<h3 id="org563df45"><span class="section-number-3">1.11</span> flooding</h3>
</div>

<div id="outline-container-org35f1cee" class="outline-3">
<h3 id="org35f1cee"><span class="section-number-3">1.12</span> fork</h3>
</div>

<div id="outline-container-orge6c0353" class="outline-3">
<h3 id="orge6c0353"><span class="section-number-3">1.13</span> hard fork</h3>
</div>

<div id="outline-container-orgba55c92" class="outline-3">
<h3 id="orgba55c92"><span class="section-number-3">1.14</span> hash</h3>
</div>

<div id="outline-container-org85714ac" class="outline-3">
<h3 id="org85714ac"><span class="section-number-3">1.15</span> genesis block</h3>
</div>

<div id="outline-container-org3141d06" class="outline-3">
<h3 id="org3141d06"><span class="section-number-3">1.16</span> mempool</h3>
</div>

<div id="outline-container-org4d73365" class="outline-3">
<h3 id="org4d73365"><span class="section-number-3">1.17</span> merkle root</h3>
</div>

<div id="outline-container-orga4d1e79" class="outline-3">
<h3 id="orga4d1e79"><span class="section-number-3">1.18</span> miner</h3>
</div>

<div id="outline-container-orgd08b887" class="outline-3">
<h3 id="orgd08b887"><span class="section-number-3">1.19</span> multisignature</h3>
</div>

<div id="outline-container-org0ee2343" class="outline-3">
<h3 id="org0ee2343"><span class="section-number-3">1.20</span> nonce</h3>
</div>

<div id="outline-container-orgcd176cb" class="outline-3">
<h3 id="orgcd176cb"><span class="section-number-3">1.21</span> output</h3>
</div>

<div id="outline-container-org15b275f" class="outline-3">
<h3 id="org15b275f"><span class="section-number-3">1.22</span> p2pkh</h3>
</div>

<div id="outline-container-org2c75254" class="outline-3">
<h3 id="org2c75254"><span class="section-number-3">1.23</span> p2sh</h3>
</div>

<div id="outline-container-org61504ae" class="outline-3">
<h3 id="org61504ae"><span class="section-number-3">1.24</span> pooled mining</h3>
</div>

<div id="outline-container-org300205a" class="outline-3">
<h3 id="org300205a"><span class="section-number-3">1.25</span> proof of work</h3>
</div>

<div id="outline-container-org9783292" class="outline-3">
<h3 id="org9783292"><span class="section-number-3">1.26</span> reward</h3>
</div>

<div id="outline-container-org5585817" class="outline-3">
<h3 id="org5585817"><span class="section-number-3">1.27</span> satoshi</h3>
</div>

<div id="outline-container-org31fcb1f" class="outline-3">
<h3 id="org31fcb1f"><span class="section-number-3">1.28</span> script</h3>
</div>

<div id="outline-container-orgdd57f67" class="outline-3">
<h3 id="orgdd57f67"><span class="section-number-3">1.29</span> ScriptPubKey</h3>
</div>

<div id="outline-container-orgbfe0c6b" class="outline-3">
<h3 id="orgbfe0c6b"><span class="section-number-3">1.30</span> ScriptSig</h3>
</div>

<div id="outline-container-org65b672f" class="outline-3">
<h3 id="org65b672f"><span class="section-number-3">1.31</span> SHA</h3>
</div>

<div id="outline-container-orgce2a4c6" class="outline-3">
<h3 id="orgce2a4c6"><span class="section-number-3">1.32</span> SPV</h3>
</div>

<div id="outline-container-orgb08c512" class="outline-3">
<h3 id="orgb08c512"><span class="section-number-3">1.33</span> transaction</h3>
</div>

<div id="outline-container-org03b772d" class="outline-3">
<h3 id="org03b772d"><span class="section-number-3">1.34</span> UTXO</h3>
</div>

<div id="outline-container-org62fa4e7" class="outline-3">
<h3 id="org62fa4e7"><span class="section-number-3">1.35</span> wallet</h3>
</div>
</div>

<div id="outline-container-orga44c104" class="outline-2">
<h2 id="orga44c104"><span class="section-number-2">2</span> Cryptography &amp; Cryptocurrency</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org08c75cc" class="outline-3">
<h3 id="org08c75cc"><span class="section-number-3">2.1</span> Hash</h3>
<div class="outline-text-3" id="text-2-1">
<p>
collision free?
</p>
</div>
</div>

<div id="outline-container-org3b31ecc" class="outline-3">
<h3 id="org3b31ecc"><span class="section-number-3">2.2</span> Hash Pointer</h3>
<div class="outline-text-3" id="text-2-2">

<div id="org07337b6" class="figure">
<p><img src="../extra/hash_pointer.png" alt="hash_pointer.png" />
</p>
</div>


<div id="org98ec59e" class="figure">
<p><img src="../extra/merkle_tree.png" alt="merkle_tree.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org8c26f10" class="outline-3">
<h3 id="org8c26f10"><span class="section-number-3">2.3</span> Public Key Cryptography</h3>
</div>

<div id="outline-container-org220efa2" class="outline-3">
<h3 id="org220efa2"><span class="section-number-3">2.4</span> Digital Signature</h3>
</div>

<div id="outline-container-orgf9663db" class="outline-3">
<h3 id="orgf9663db"><span class="section-number-3">2.5</span> Elliptic Curve Cryptography (ECC)</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-orgbea0584" class="outline-4">
<h4 id="orgbea0584"><span class="section-number-4">2.5.1</span> A gentle introduction</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
<a href="http://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/">http://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/</a>
</p>
</div>
</div>

<div id="outline-container-org0aa2c15" class="outline-4">
<h4 id="org0aa2c15"><span class="section-number-4">2.5.2</span> Example: public key encryption</h4>
<div class="outline-text-4" id="text-2-5-2">
<ul class="org-ul">
<li>M plain text</li>
<li>K public key</li>
<li>k private key</li>
<li>G base point</li>
<li>K = kG</li>
<li>C cipher text</li>
<li>r a random number</li>
</ul>
<ul class="org-ul">
<li><p>
sender
</p>

<p>
C=(rG,M+rK)
</p></li>

<li><p>
receiver
</p>

<p>
M+rK-k(rG)=M+rK-r(kG)=M+rK-rK=M
</p>

<p>
注意: receiver 用 public key 无法解出 M
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org9d015ca" class="outline-4">
<h4 id="org9d015ca"><span class="section-number-4">2.5.3</span> Example: digital signature (ECDSA)</h4>
<div class="outline-text-4" id="text-2-5-3">
<ul class="org-ul">
<li>h hash</li>
<li>K public key</li>
<li>k private key</li>
<li>G(x,y) base point</li>
<li>C signature</li>
<li>r a random number</li>
</ul>
<ul class="org-ul">
<li><p>
sender
</p>

<p>
s=(h+kx)/r
</p>

<p>
C=(rG,s)
</p></li>

<li><p>
receiver
</p>

<p>
hG/s + xK/s = hG/s+xkG/s = (h+xk)G/s = (h+xk)Gr/(h+kx) = rG
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga25c9c6" class="outline-3">
<h3 id="orga25c9c6"><span class="section-number-3">2.6</span> Cryptocurrency</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-orge107d8d" class="outline-4">
<h4 id="orge107d8d"><span class="section-number-4">2.6.1</span> Simple cryptocurrency</h4>
<div class="outline-text-4" id="text-2-6-1">

<div id="org242e962" class="figure">
<p><a href="../extra/third_passage_of_coin.png"><img src="../extra/third_passage_of_coin.png" alt="third_passage_of_coin.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgfebea45" class="outline-4">
<h4 id="orgfebea45"><span class="section-number-4">2.6.2</span> Double-spent problem</h4>
<div class="outline-text-4" id="text-2-6-2">

<div id="orgcb8cf80" class="figure">
<p><a href="../extra/goofy_coin_double_spending.png"><img src="../extra/goofy_coin_double_spending.png" alt="goofy_coin_double_spending.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgcb6f437" class="outline-4">
<h4 id="orgcb6f437"><span class="section-number-4">2.6.3</span> The solution: a public transaction history</h4>
<div class="outline-text-4" id="text-2-6-3">

<div id="orgec1c0ab" class="figure">
<p><a href="../extra/scroogecoin.png"><img src="../extra/scroogecoin.png" alt="scroogecoin.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org3be8e3e" class="outline-4">
<h4 id="org3be8e3e"><span class="section-number-4">2.6.4</span> Who will maintain the public transaction history?</h4>
</div>
</div>
</div>

<div id="outline-container-org8dd1dfa" class="outline-2">
<h2 id="org8dd1dfa"><span class="section-number-2">3</span> Introduction of Bitcoin</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org4e3ccd5" class="outline-3">
<h3 id="org4e3ccd5"><span class="section-number-3">3.1</span> The Byzantine Generals Problem</h3>
<div class="outline-text-3" id="text-3-1">
<pre class="example" id="org56051c4">
A,B,C 是将军, D 是叛徒, 四人通过信使商量是否进攻:

A tell {B,C,D}: attack
B tell {A,C,D}: attack
C tell {A,B,D}: wait     

D tell {A,B,C}: {attack, attack, wait}
</pre>
</div>
</div>

<div id="outline-container-org91879f7" class="outline-3">
<h3 id="org91879f7"><span class="section-number-3">3.2</span> What Is Bitcoin?</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>2008, "Bitcoin: A Peer-to-Peer Electronic Cash System" by "Satoshi Nakamoto"</li>
<li>A decentralized peer-to-peer network (bitcoin protocol)</li>
<li>A public transaction ledger (blockchain)</li>
<li>A set of rules for independent transaction validation (script)</li>
<li>!! A mechanism for reaching global decentralized consensus (PoW)</li>
</ul>
</div>
</div>

<div id="outline-container-org86a988a" class="outline-3">
<h3 id="org86a988a"><span class="section-number-3">3.3</span> Example: use bitcoin to buy a cup of coffee</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>Choosing a Bitcoin Wallet</li>
<li>Getting Your First Bitcoin</li>
<li>Finding the Current Price of Bitcoin</li>
<li>Sending and Receiving Bitcoin</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org9ed8835" class="outline-2">
<h2 id="org9ed8835"><span class="section-number-2">4</span> How Bitcoin Works</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgb11acf6" class="outline-3">
<h3 id="orgb11acf6"><span class="section-number-3">4.1</span> Constructing a Transaction</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-orgc2b8570" class="outline-4">
<h4 id="orgc2b8570"><span class="section-number-4">4.1.1</span> Getting the Right Inputs</h4>
</div>

<div id="outline-container-org9111313" class="outline-4">
<h4 id="org9111313"><span class="section-number-4">4.1.2</span> Creating the Outputs</h4>
</div>
</div>

<div id="outline-container-orgc9112c2" class="outline-3">
<h3 id="orgc9112c2"><span class="section-number-3">4.2</span> Constructing a Block</h3>
</div>

<div id="outline-container-org569970a" class="outline-3">
<h3 id="org569970a"><span class="section-number-3">4.3</span> Mining the Block</h3>
</div>

<div id="outline-container-org4345738" class="outline-3">
<h3 id="org4345738"><span class="section-number-3">4.4</span> Publish Block To Blockchain</h3>
</div>
</div>

<div id="outline-container-orgbe2ae27" class="outline-2">
<h2 id="orgbe2ae27"><span class="section-number-2">5</span> Transactions</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org5eec6cc" class="outline-3">
<h3 id="org5eec6cc"><span class="section-number-3">5.1</span> Transaction</h3>
<div class="outline-text-3" id="text-5-1">
<pre class="example" id="org7e5db8c">
transaction_hash
vin
  input1
  input2
  ...
vout
  output1
  output2
  ...
</pre>
</div>

<div id="outline-container-org09fe097" class="outline-4">
<h4 id="org09fe097"><span class="section-number-4">5.1.1</span> A real bitcoin transaction</h4>
<div class="outline-text-4" id="text-5-1-1">

<div id="orgfb4f25e" class="figure">
<p><img src="../extra/bitcoin_transaction.png" alt="bitcoin_transaction.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org8552baa" class="outline-3">
<h3 id="org8552baa"><span class="section-number-3">5.2</span> Transaction Inputs</h3>
<div class="outline-text-3" id="text-5-2">
<pre class="example" id="org17f0db1">
prev_out
  transaction_hash
  vout_index
scriptSig
</pre>
</div>
</div>

<div id="outline-container-orgf23eca7" class="outline-3">
<h3 id="orgf23eca7"><span class="section-number-3">5.3</span> Transaction Outputs</h3>
<div class="outline-text-3" id="text-5-3">
<pre class="example" id="orgf9d246a">
value
scriptPubKey
</pre>
</div>
</div>

<div id="outline-container-org3551f32" class="outline-3">
<h3 id="org3551f32"><span class="section-number-3">5.4</span> Transaction Fees</h3>
<div class="outline-text-3" id="text-5-4">
</div>
<div id="outline-container-org6addcb3" class="outline-4">
<h4 id="org6addcb3"><span class="section-number-4">5.4.1</span> the miner may choose transactions with high fees</h4>
<div class="outline-text-4" id="text-5-4-1">

<div id="org2f0b721" class="figure">
<p><a href="../extra/transaction_fee.png"><img src="../extra/transaction_fee.png" alt="transaction_fee.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org6a66c89" class="outline-4">
<h4 id="org6a66c89"><span class="section-number-4">5.4.2</span> transaction fees are implied in the transaction, by Sum(inputs) - Sum(outputs)</h4>
<div class="outline-text-4" id="text-5-4-2">

<div id="org3f14a25" class="figure">
<p><a href="../extra/transaction_fee_2.png"><img src="../extra/transaction_fee_2.png" alt="transaction_fee_2.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org8ee1123" class="outline-4">
<h4 id="org8ee1123"><span class="section-number-4">5.4.3</span> transaction fees are rewarded to miner in coinbase transaction</h4>
<div class="outline-text-4" id="text-5-4-3">

<div id="org303cef6" class="figure">
<p><a href="../extra/coinbase_transaction.png"><img src="../extra/coinbase_transaction.png" alt="coinbase_transaction.png" /></a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org53e5b41" class="outline-3">
<h3 id="org53e5b41"><span class="section-number-3">5.5</span> Script</h3>
<div class="outline-text-3" id="text-5-5">
</div>
<div id="outline-container-org82b8df5" class="outline-4">
<h4 id="org82b8df5"><span class="section-number-4">5.5.1</span> stack based language</h4>
<div class="outline-text-4" id="text-5-5-1">
<pre class="example" id="org68441a9">
2 3 OP_ADD 5 OP_EQUAL
</pre>
</div>
</div>

<div id="outline-container-org70ec214" class="outline-4">
<h4 id="org70ec214"><span class="section-number-4">5.5.2</span> Pay-to-Public-Key-Hash (P2PKH)</h4>
<div class="outline-text-4" id="text-5-5-2">
</div>
<div id="outline-container-orgb13ab20" class="outline-5">
<h5 id="orgb13ab20"><span class="section-number-5">5.5.2.1</span> locking script</h5>
<div class="outline-text-5" id="text-5-5-2-1">
<pre class="example" id="org7d2d1ef">
OP_DUP OP_HASH160 &lt;Cafe Public Key Hash&gt;
OP_EQUALVERIFY OP_CHECKSIG
</pre>
</div>
</div>

<div id="outline-container-org0e680e2" class="outline-5">
<h5 id="org0e680e2"><span class="section-number-5">5.5.2.2</span> unlocking script</h5>
<div class="outline-text-5" id="text-5-5-2-2">
<pre class="example" id="orgbf39d00">
&lt;Cafe Signature&gt; &lt;Cafe Public Key&gt;
</pre>
</div>
</div>

<div id="outline-container-org30a4cdd" class="outline-5">
<h5 id="org30a4cdd"><span class="section-number-5">5.5.2.3</span> eval</h5>
<div class="outline-text-5" id="text-5-5-2-3">
<p>
unlocking script + locking script:
</p>
<pre class="example" id="org0c9f2d0">
&lt;Cafe Signature&gt; &lt;Cafe Public Key&gt;  OP_DUP OP_HASH160
&lt;Cafe Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG
</pre>
</div>
</div>
</div>

<div id="outline-container-orge25b523" class="outline-4">
<h4 id="orge25b523"><span class="section-number-4">5.5.3</span> Digital Signatures (ECDSA)</h4>
</div>

<div id="outline-container-org08e0bb2" class="outline-4">
<h4 id="org08e0bb2"><span class="section-number-4">5.5.4</span> Bitcoin Addresses, Balances, and Other Abstractions</h4>
</div>
</div>

<div id="outline-container-org31152d2" class="outline-3">
<h3 id="org31152d2"><span class="section-number-3">5.6</span> Advanced Script</h3>
<div class="outline-text-3" id="text-5-6">
</div>
<div id="outline-container-orgd8a8f98" class="outline-4">
<h4 id="orgd8a8f98"><span class="section-number-4">5.6.1</span> Multisignature</h4>
<div class="outline-text-4" id="text-5-6-1">
</div>
<div id="outline-container-orgb8e54ea" class="outline-5">
<h5 id="orgb8e54ea"><span class="section-number-5">5.6.1.1</span> locking script:</h5>
<div class="outline-text-5" id="text-5-6-1-1">
<pre class="example" id="org955f099">
2 &lt;Public Key A&gt; &lt;Public Key B&gt; &lt;Public Key C&gt; 3 CHECKMULTISIG
</pre>
</div>
</div>

<div id="outline-container-org15d5fea" class="outline-5">
<h5 id="org15d5fea"><span class="section-number-5">5.6.1.2</span> unlocking script:</h5>
<div class="outline-text-5" id="text-5-6-1-2">
<pre class="example" id="org5342d2d">
&lt;Signature B&gt; &lt;Signature C&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org05b5341" class="outline-4">
<h4 id="org05b5341"><span class="section-number-4">5.6.2</span> Multisignature Example: escrow transaction</h4>
<div class="outline-text-4" id="text-5-6-2">
<ul class="org-ul">
<li>suppose Alice want to pay Bob, but with Judy as escrow, two
transactions are needed:</li>
</ul>

<pre class="example" id="orgbb1f8e6">
pay to bob:

2 &lt;Public Key Alice&gt; &lt;Public Key Bob&gt; &lt;Public Key Judy&gt; 3 CHECKMULTISIG

pay back to alice:

2 &lt;Public Key Alice&gt; &lt;Public Key Judy&gt; 2 CHECKMULTISIG
</pre>
</div>
</div>

<div id="outline-container-orga124022" class="outline-4">
<h4 id="orga124022"><span class="section-number-4">5.6.3</span> Pay-to-Script-Hash (P2SH)</h4>
<div class="outline-text-4" id="text-5-6-3">
</div>
<div id="outline-container-org7122af3" class="outline-5">
<h5 id="org7122af3"><span class="section-number-5">5.6.3.1</span> drawbacks of multisig</h5>
</div>

<div id="outline-container-org5dd4364" class="outline-5">
<h5 id="org5dd4364"><span class="section-number-5">5.6.3.2</span> Redeem Script:</h5>
<div class="outline-text-5" id="text-5-6-3-2">
<pre class="example" id="orgbf9b54e">
2 PubKey1 PubKey2 PubKey3 PubKey4 PubKey5 5 CHECKMULTISIG
</pre>
</div>
</div>

<div id="outline-container-org9c45c49" class="outline-5">
<h5 id="org9c45c49"><span class="section-number-5">5.6.3.3</span> Locking Script:</h5>
<div class="outline-text-5" id="text-5-6-3-3">
<pre class="example" id="org21e0e14">
HASH160 &lt;20-byte hash of redeem script&gt; EQUAL
</pre>
</div>
</div>

<div id="outline-container-orgaa9cfae" class="outline-5">
<h5 id="orgaa9cfae"><span class="section-number-5">5.6.3.4</span> Unlocking Script:</h5>
<div class="outline-text-5" id="text-5-6-3-4">
<pre class="example" id="orgb082a7f">
Sig1 Sig2 &lt;redeem script&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org48650f6" class="outline-4">
<h4 id="org48650f6"><span class="section-number-4">5.6.4</span> TimeLocks</h4>
<div class="outline-text-4" id="text-5-6-4">
</div>
<div id="outline-container-org37d5776" class="outline-5">
<h5 id="org37d5776"><span class="section-number-5">5.6.4.1</span> locking script</h5>
<div class="outline-text-5" id="text-5-6-4-1">
<pre class="example" id="org2c6fe6a">
&lt;now + 3 months&gt; CHECKLOCKTIMEVERIFY DROP DUP HASH160 &lt;Bob's Public
Key Hash&gt; EQUALVERIFY CHECKSIG
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f06b10" class="outline-4">
<h4 id="org5f06b10"><span class="section-number-4">5.6.5</span> Complex Script Example</h4>
<div class="outline-text-4" id="text-5-6-5">
<pre class="example" id="org66f47ed">
locking script:

  IF
    IF
      2
    ELSE
      &lt;30 days&gt; CHECKSEQUENCEVERIFY DROP
      &lt;Abdul the Lawyer's Pubkey&gt; CHECKSIGVERIFY
      1
    ENDIF
    &lt;Mohammed's Pubkey&gt; &lt;Saeed's Pubkey&gt;
      &lt;Zaira's Pubkey&gt; 3 CHECKMULTISIG
  ELSE
    &lt;90 days&gt; CHECKSEQUENCEVERIFY DROP
    &lt;Abdul the Lawyer's Pubkey&gt; CHECKSIG
  ENDIF

unlocking script:

I:   0 &lt;Mohammed's Sig&gt; &lt;Zaira's Sig&gt; TRUE TRUE
II:  0 &lt;Saeed's Sig&gt; &lt;Abdul's Sig&gt; FALSE TRUE
III: &lt;Abdul's Sig&gt; FALSE
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org80ac3dc" class="outline-2">
<h2 id="org80ac3dc"><span class="section-number-2">6</span> The Block</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgfe01b23" class="outline-3">
<h3 id="orgfe01b23"><span class="section-number-3">6.1</span> Structure Of A Block</h3>
<div class="outline-text-3" id="text-6-1">
<pre class="example" id="org9a71e2d">
block_header
    prev_block_hash
    difficulty
    nonce
    merkle_root
transactions_count  
[transactions]  
</pre>


<div id="org81be9f1" class="figure">
<p><a href="../extra/block_structure.png"><img src="../extra/block_structure.png" alt="block_structure.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org6f3fdc4" class="outline-3">
<h3 id="org6f3fdc4"><span class="section-number-3">6.2</span> The Genesis Block</h3>
<div class="outline-text-3" id="text-6-2">
<p>
<a href="https://blockchain.info/block-index/14849">https://blockchain.info/block-index/14849</a>
</p>


<div id="org2a9094f" class="figure">
<p><a href="../extra/genesis_block.png"><img src="../extra/genesis_block.png" alt="genesis_block.png" /></a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orga0b479f" class="outline-2">
<h2 id="orga0b479f"><span class="section-number-2">7</span> The Blockchain</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org308f55f" class="outline-3">
<h3 id="org308f55f"><span class="section-number-3">7.1</span> Linking Blocks In The Blockchain</h3>
<div class="outline-text-3" id="text-7-1">

<div id="orgccec389" class="figure">
<p><a href="../extra/blockchain_structure_link.png"><img src="../extra/blockchain_structure_link.png" alt="blockchain_structure_link.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgf3e3fec" class="outline-3">
<h3 id="orgf3e3fec"><span class="section-number-3">7.2</span> Merkle Trees and Simplified Payment Verification (SPV)</h3>
<div class="outline-text-3" id="text-7-2">
<p>
SPV need to know `whether a transaction is in the block chain`, with
the help of merkle path, a malicious node can't lie if the transaction
doesn't exist.
</p>


<div id="org264e952" class="figure">
<p><a href="../extra/merkle_path.png"><img src="../extra/merkle_path.png" alt="merkle_path.png" /></a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd9833dd" class="outline-2">
<h2 id="orgd9833dd"><span class="section-number-2">8</span> Mining and Consensus</h2>
<div class="outline-text-2" id="text-8">
<p>
Bitcoin depends on miner to:
</p>
<ol class="org-ol">
<li>store and broadcast block chain</li>
<li>validate new transactions</li>
<li>vote on consensus</li>
</ol>
</div>

<div id="outline-container-orgf713402" class="outline-3">
<h3 id="orgf713402"><span class="section-number-3">8.1</span> Mining bitcoins in 6 steps</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-orgf5f6a95" class="outline-4">
<h4 id="orgf5f6a95"><span class="section-number-4">8.1.1</span> join the network, listen for and validate transactions</h4>
</div>

<div id="outline-container-org10929e9" class="outline-4">
<h4 id="org10929e9"><span class="section-number-4">8.1.2</span> listen for new blocks, maintain block chain</h4>
</div>

<div id="outline-container-orgb5f47d7" class="outline-4">
<h4 id="orgb5f47d7"><span class="section-number-4">8.1.3</span> assemble new block</h4>
</div>

<div id="outline-container-orgefaa4f3" class="outline-4">
<h4 id="orgefaa4f3"><span class="section-number-4">8.1.4</span> find the nonce to make your block valid</h4>
</div>

<div id="outline-container-orgd7cd24c" class="outline-4">
<h4 id="orgd7cd24c"><span class="section-number-4">8.1.5</span> hope everybody accepts your new block</h4>
</div>

<div id="outline-container-org3e6a6aa" class="outline-4">
<h4 id="org3e6a6aa"><span class="section-number-4">8.1.6</span> profit!</h4>
</div>
</div>

<div id="outline-container-org8aa4352" class="outline-3">
<h3 id="org8aa4352"><span class="section-number-3">8.2</span> Aggregating Transactions into Blocks</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>Coinbase Transaction</li>

<li><p>
Coinbase Reward and Fees
</p>

<p>
reward halved every four years
</p></li>

<li>Constructing the Block Header</li>
</ul>
</div>
</div>

<div id="outline-container-orgd14bd2e" class="outline-3">
<h3 id="orgd14bd2e"><span class="section-number-3">8.3</span> Mining the Block</h3>
<div class="outline-text-3" id="text-8-3">
</div>
<div id="outline-container-orgb8b1aee" class="outline-4">
<h4 id="orgb8b1aee"><span class="section-number-4">8.3.1</span> Proof-of-Work Algorithm</h4>
<div class="outline-text-4" id="text-8-3-1">

<div id="org654ced7" class="figure">
<p><a href="../extra/pow.png"><img src="../extra/pow.png" alt="pow.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgd115c52" class="outline-4">
<h4 id="orgd115c52"><span class="section-number-4">8.3.2</span> Adjust Difficulty</h4>
<div class="outline-text-4" id="text-8-3-2">
<p>
difficulty is changed for every 2 weeks or 2016 blocks are mined:
</p>


<div id="org87962f5" class="figure">
<p><a href="../extra/mining_difficulty.png"><img src="../extra/mining_difficulty.png" alt="mining_difficulty.png" /></a>
</p>
</div>

<p>
adjust difficulty so that the mean mining time of one block is 10 min
</p>

<p>
<code>exponential distribution</code>
</p>


<div id="org3903830" class="figure">
<p><a href="../extra/difficulty.png"><img src="../extra/difficulty.png" alt="difficulty.png" /></a>  
</p>
</div>
</div>
</div>

<div id="outline-container-org82e8659" class="outline-4">
<h4 id="org82e8659"><span class="section-number-4">8.3.3</span> Block propagation</h4>
</div>
</div>

<div id="outline-container-org03ace0b" class="outline-3">
<h3 id="org03ace0b"><span class="section-number-3">8.4</span> Mining Pools</h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li>Time to find first block using one ASIC mining hardware:</li>
</ul>


<div id="org13f761b" class="figure">
<p><a href="../extra/mining_pool.png"><img src="../extra/mining_pool.png" alt="mining_pool.png" /></a>
</p>
</div>
</div>

<div id="outline-container-org1308169" class="outline-4">
<h4 id="org1308169"><span class="section-number-4">8.4.1</span> Goal</h4>
<div class="outline-text-4" id="text-8-4-1">
<ul class="org-ul">
<li>pool participants all attempt to mine a block with the same coinbase
recipient: to the pool manager</li>

<li>the pool manager distribute revenues to members based on how much
work they have performed</li>

<li>How do we know how much work each member perform?</li>
</ul>


<div id="org627484c" class="figure">
<p><a href="../extra/mining_pool_manager.png"><img src="../extra/mining_pool_manager.png" alt="mining_pool_manager.png" /></a>  
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org6498aab" class="outline-3">
<h3 id="org6498aab"><span class="section-number-3">8.5</span> Blockchain Forks</h3>
<div class="outline-text-3" id="text-8-5">
</div>
<div id="outline-container-orga02d6aa" class="outline-4">
<h4 id="orga02d6aa"><span class="section-number-4">8.5.1</span> What if two blocks are mined simultaneously?</h4>
<div class="outline-text-4" id="text-8-5-1">
<p>
<code>THE LONGER CHAIN WINS</code>
</p>


<div id="orgba2d441" class="figure">
<p><a href="../extra/bitcoin_fork.png"><img src="../extra/bitcoin_fork.png" alt="bitcoin_fork.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgb1e3e75" class="outline-4">
<h4 id="orgb1e3e75"><span class="section-number-4">8.5.2</span> Majority attack (51% attack)</h4>
<div class="outline-text-4" id="text-8-5-2">
<ul class="org-ul">
<li><a href="https://en.bitcoin.it/wiki/Majority_attack">Majority attack</a></li>
<li><a href="https://people.xiph.org/~greg/attack_success.html">Attack success probability calculator</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #268bd2;">#include</span> <span style="color: #2aa198;">&lt;math.h&gt;</span>
<span style="color: #b58900;">double</span> <span style="color: #268bd2;">AttackerSuccessProbability</span><span style="color: #757575;">(</span><span style="color: #b58900;">double</span> <span style="color: #268bd2;">q</span><span style="color: #757575;">,</span> <span style="color: #b58900;">int</span> <span style="color: #268bd2;">z</span><span style="color: #757575;">)</span>
<span style="color: #757575;">{</span>
  <span style="color: #b58900;">double</span> <span style="color: #268bd2;">p</span> = 1.0 - q;
  <span style="color: #b58900;">double</span> <span style="color: #268bd2;">lambda</span> = z * <span style="color: #757575;">(</span>q / p<span style="color: #757575;">)</span>;
  <span style="color: #b58900;">double</span> <span style="color: #268bd2;">sum</span> = 1.0;
  <span style="color: #b58900;">int</span> <span style="color: #268bd2;">i</span><span style="color: #757575;">,</span> <span style="color: #268bd2;">k</span>;
  <span style="color: #859900;">for</span> <span style="color: #757575;">(</span>k = 0; k &lt;= z; k++<span style="color: #757575;">)</span>
  <span style="color: #757575;">{</span>
    <span style="color: #b58900;">double</span> <span style="color: #268bd2;">poisson</span> = exp<span style="color: #757575;">(</span>-lambda<span style="color: #757575;">)</span>;
    <span style="color: #859900;">for</span> <span style="color: #757575;">(</span>i = 1; i &lt;= k; i++<span style="color: #757575;">)</span>
      poisson *= lambda / i;
    sum -= poisson * <span style="color: #757575;">(</span>1 - pow<span style="color: #757575;">(</span>q / p<span style="color: #757575;">,</span> z - k<span style="color: #757575;">))</span>;
  <span style="color: #757575;">}</span>
  <span style="color: #859900;">return</span> sum;
<span style="color: #757575;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdb5fd29" class="outline-3">
<h3 id="orgdb5fd29"><span class="section-number-3">8.6</span> Hard Forks</h3>
<div class="outline-text-3" id="text-8-6">
<ul class="org-ul">
<li>hard forks occur when part of the network is operating under a
different set of consensus rules</li>

<li>the network does not re-converge onto a single chain. Instead, the
two chains evolve independently</li>

<li>currently, the major motivation for bitcoin hard fork is:
<ol class="org-ol">
<li>low transaction throughput</li>
<li>high transaction fee</li>
</ol></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org1178282" class="outline-2">
<h2 id="org1178282"><span class="section-number-2">9</span> The Bitcoin Network</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgf0d6fa7" class="outline-3">
<h3 id="orgf0d6fa7"><span class="section-number-3">9.1</span> Peer-to-Peer Network Architecture</h3>
<div class="outline-text-3" id="text-9-1">
<p>
bitcoin network is mostly used for:
</p>

<ol class="org-ol">
<li>transaction propagation</li>
<li>block propagation</li>
</ol>
</div>
</div>

<div id="outline-container-org8f4ab58" class="outline-3">
<h3 id="org8f4ab58"><span class="section-number-3">9.2</span> Network Discovery</h3>
<div class="outline-text-3" id="text-9-2">
<p>
the initial seed `5` maybe specified by command line or hard coded in
bitcoin core application
</p>


<div id="org4ec0d0a" class="figure">
<p><a href="../extra/network_discovery.png"><img src="../extra/network_discovery.png" alt="network_discovery.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-org6db74f4" class="outline-3">
<h3 id="org6db74f4"><span class="section-number-3">9.3</span> Transaction Pools</h3>
<div class="outline-text-3" id="text-9-3">
<p>
transactions are flooded to every node in the network, and placed in
node's `transaction pool`. however, the per node transaction pool may
not be identical (networking latency, malicious node, &#x2026;)
</p>
</div>
</div>

<div id="outline-container-orgd1331c4" class="outline-3">
<h3 id="orgd1331c4"><span class="section-number-3">9.4</span> Node Types and Roles</h3>
<div class="outline-text-3" id="text-9-4">
</div>
<div id="outline-container-org2704407" class="outline-4">
<h4 id="org2704407"><span class="section-number-4">9.4.1</span> Fully-validating nodes</h4>
<div class="outline-text-4" id="text-9-4-1">
<ul class="org-ul">
<li>permanently connected</li>
<li>store entire block chain (20GB)</li>
<li>hear and forward every transaction</li>
</ul>
</div>
</div>

<div id="outline-container-org96a6ca3" class="outline-4">
<h4 id="org96a6ca3"><span class="section-number-4">9.4.2</span> SPV node</h4>
<div class="outline-text-4" id="text-9-4-2">
<ul class="org-ul">
<li>store block headers only (20MB)</li>
<li>request transactions as needed</li>
<li>trust fully-validating nodes</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5482925" class="outline-3">
<h3 id="org5482925"><span class="section-number-3">9.5</span> Simplified Payment Verification (SPV) Nodes</h3>
<div class="outline-text-3" id="text-9-5">
<ul class="org-ul">
<li>make sure transaction do exist</li>
<li>make sure no double-spent problem</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgb066577" class="outline-2">
<h2 id="orgb066577"><span class="section-number-2">10</span> The future of bitcoin (Blockchain)</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org075bd05" class="outline-3">
<h3 id="org075bd05"><span class="section-number-3">10.1</span> Smart Property</h3>
<div class="outline-text-3" id="text-10-1">
<ol class="org-ol">
<li>Car is running as one bitcoin node and listening for blockchain</li>
<li>Car is controlled by public key</li>
<li>Alice owns the car because she controls private key</li>
<li>Create a single transaction that combines Bob's payment to Alice
and Alice's ownership transfer to Bob</li>
<li>Car will update the public key from blockchain, now Bob owns the
car</li>
</ol>
</div>
</div>

<div id="outline-container-org203ebd8" class="outline-3">
<h3 id="org203ebd8"><span class="section-number-3">10.2</span> Smart Contract</h3>
<div class="outline-text-3" id="text-10-2">
<p>
the `Script` language has shown some potential capability for smart
contract: auction, lottery, crowd fund, stock, futures&#x2026;
</p>
</div>

<div id="outline-container-orgdf5251c" class="outline-4">
<h4 id="orgdf5251c"><span class="section-number-4">10.2.1</span> Ethereum</h4>
<div class="outline-text-4" id="text-10-2-1">
<p>
There is another project `Ethereum`, which is based on blockchain, and
claims to be a `decentralized platform that runs smart contracts`
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org413a397" class="outline-2">
<h2 id="org413a397"><span class="section-number-2">11</span> Appendix</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-org0df0370" class="outline-3">
<h3 id="org0df0370"><span class="section-number-3">11.1</span> A. Bitcoin Limitation</h3>
<div class="outline-text-3" id="text-11-1">
<ul class="org-ul">
<li>initial mining reward is 50 bitcoins</li>
<li>mining reward halves every 4 year</li>
<li>all bitcoin will be mined before the year 2040, with 21 million coins</li>
<li>1M bytes/block</li>
<li>over 250 bytes/transaction</li>
<li>at most 4000 transactions/block</li>
<li>it takes 10 min to mine one block</li>
<li>7 transaction/sec ):</li>
</ul>
</div>
</div>

<div id="outline-container-org60b7125" class="outline-3">
<h3 id="org60b7125"><span class="section-number-3">11.2</span> B. Mining Hardware</h3>
<div class="outline-text-3" id="text-11-2">
<ul class="org-ul">
<li>CPU    140,000 years to find a block today (2014)</li>
<li>GPU    173 years</li>
<li>FPGA   25 years</li>
<li>ASIC   1 year</li>
</ul>

<p>
Does the existence of ASICs and large mining centers go
against the original vision of Satoshi Nakamoto?
</p>

<p>
最新数据显示`比特大陆`控制的 ASCI mining center 已经达到了 40% 的全网算力.
</p>

<p>
以致于它可以强行 hard fork 出 bitcoin cash.
</p>
</div>
</div>

<div id="outline-container-orgf94282f" class="outline-3">
<h3 id="orgf94282f"><span class="section-number-3">11.3</span> C. Resources</h3>
<div class="outline-text-3" id="text-11-3">
<ul class="org-ul">
<li><a href="https://jeiwan.cc/posts/building-blockchain-in-go-part-1/">Building Blockchain in Go</a></li>
<li><a href="https://book.douban.com/subject/25855986/">Mastering Bitcoin</a></li>
<li><a href="https://www.coursera.org/learn/cryptocurrency/home/info">Bitcoin and Cryptocurrency Technologies</a></li>
<li><a href="https://bitcoin.org/bitcoin.pdf">Bitcoin: A Peer-to-Peer Electronic Cash System</a></li>
<li><a href="https://blockchain.info/">blockchain.info</a></li>
<li><a href="http://blog.51cto.com/11821908/2057726">椭圆曲线加解密及签名算法</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: <br />
Last updated: 2022-01-14 五 13:19</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
         var d = document, s = d.createElement('script');
         s.src = '//sunwayforever-github-io.disqus.com/embed.js';
         s.setAttribute('data-timestamp', +new Date());
         (d.head || d.body).appendChild(s);
         })();
</script>
</div>
</body>
</html>
