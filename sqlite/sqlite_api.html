<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-26 Wed 20:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sqlite Api</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Wei Sun (孙伟)" />
<link rel="stylesheet" type="text/css" href="/main.css" media="screen" />
<link rel = "icon" href = "/icon.png"  type = "image/x-icon">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Sqlite Api</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge3f8e05">1. SQlite: API</a>
<ul>
<li><a href="#org77181df">1.1. sqlite3_open</a></li>
<li><a href="#org0ac12b4">1.2. sqltie3_prepare_v2</a></li>
<li><a href="#org6bfba05">1.3. sqlite3_step</a></li>
<li><a href="#orgb605a05">1.4. sqlite3_reset</a></li>
<li><a href="#org62c2b29">1.5. sqlite3_bind</a></li>
<li><a href="#org4bf7aa9">1.6. sqlite3_exec</a></li>
<li><a href="#orga17f809">1.7. sqlite3_get_tables</a></li>
<li><a href="#org0a71b35">1.8. sqlite3_mprintf</a></li>
<li><a href="#org5047a15">1.9. sqlite3_commit_hook</a></li>
<li><a href="#org37adc7e">1.10. sqlite3_rollback_hook</a></li>
<li><a href="#orgb6b0b5a">1.11. sqlite3_busy_handler</a></li>
<li><a href="#org4d08396">1.12. sqlite3_busy_timeout</a></li>
<li><a href="#org6679fda">1.13. sqlite3_profile</a></li>
<li><a href="#org2cbea35">1.14. sqlite3_trace</a></li>
<li><a href="#orgb2bc4eb">1.15. sqlite3_limit</a></li>
<li><a href="#org84930ac">1.16. sqlite3_status</a></li>
<li><a href="#org20b8366">1.17. sqlite3_db_status</a></li>
<li><a href="#org8987847">1.18. sqlite3_stmt_status</a></li>
<li><a href="#orga15c257">1.19. sqlite3_config</a></li>
<li><a href="#orge2b3ff3">1.20. sqlite3_db_config</a></li>
<li><a href="#orgc120a92">1.21. sqlite3_memory_used</a></li>
<li><a href="#org3e3c407">1.22. sqlite3_memory_highwater</a></li>
<li><a href="#orgb58777c">1.23. sqlite3_last_insert_rowid</a></li>
<li><a href="#orgba29277">1.24. sqlite3_set_authorizer</a></li>
<li><a href="#org557c4d7">1.25. sqlite3_changes</a></li>
<li><a href="#orgbede2e9">1.26. sqlite3_get_tables</a></li>
<li><a href="#org4bd014e">1.27. sqlite3_commit_hook</a></li>
<li><a href="#orga7dc975">1.28. sqlite3_rollback_hook</a></li>
<li><a href="#org5fe6095">1.29. sqlite3_update_hook</a></li>
<li><a href="#orga77d57e">1.30. sqlite3_release_memory</a></li>
<li><a href="#orgde250a4">1.31. sqlite3_db_release_memory</a></li>
<li><a href="#org4cc689a">1.32. sqlite3_soft_heap_limit64</a></li>
<li><a href="#orgab4e45b">1.33. sqlite3_table_column_metadata</a></li>
<li><a href="#org31dce3e">1.34. blob 操作</a>
<ul>
<li><a href="#orgf4ac711">1.34.1. sqlite3_blob_open</a></li>
<li><a href="#org8adee09">1.34.2. sqlite3_blob_read</a></li>
<li><a href="#org4d04be9">1.34.3. sqlite3_blob_write</a></li>
</ul>
</li>
<li><a href="#orgd183739">1.35. mutex</a>
<ul>
<li><a href="#org6f59bf7">1.35.1. sqlite3_mutex_alloc</a></li>
<li><a href="#orgfbfd7cc">1.35.2. sqlite3_mutex_enter</a></li>
<li><a href="#orgc935ad0">1.35.3. sqlite3_mutex_free</a></li>
<li><a href="#org83f3085">1.35.4. sqlite3_mutex_try</a></li>
<li><a href="#orgf02fdbc">1.35.5. sqlite3_mutex_leave</a></li>
</ul>
</li>
<li><a href="#org26b3db3">1.36. wal</a>
<ul>
<li><a href="#orgf8261c9">1.36.1. sqlite3_wal_hook</a></li>
<li><a href="#org2f00f60">1.36.2. sqlite3_wal_autocheckpoint</a></li>
<li><a href="#org58b957f">1.36.3. sqlite3_wal_checkpoint_v2</a></li>
</ul>
</li>
<li><a href="#org6b57d4c">1.37. sqlite3_file_control</a></li>
<li><a href="#org28e6b7d">1.38. sqlite3_finalize</a></li>
<li><a href="#orgc147ecd">1.39. extension api</a>
<ul>
<li><a href="#org1170a18">1.39.1. user defined functions</a></li>
<li><a href="#org6c8f09c">1.39.2. user defined aggregates</a></li>
<li><a href="#orgfb16b6d">1.39.3. user define collations</a></li>
</ul>
</li>
<li><a href="#org1171b23">1.40. sample code</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orge3f8e05" class="outline-2">
<h2 id="orge3f8e05"><span class="section-number-2">1</span> SQlite: API</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org77181df" class="outline-3">
<h3 id="org77181df"><span class="section-number-3">1.1</span> sqlite3_open</h3>
</div>

<div id="outline-container-org0ac12b4" class="outline-3">
<h3 id="org0ac12b4"><span class="section-number-3">1.2</span> sqltie3_prepare_v2</h3>
</div>

<div id="outline-container-org6bfba05" class="outline-3">
<h3 id="org6bfba05"><span class="section-number-3">1.3</span> sqlite3_step</h3>
</div>

<div id="outline-container-orgb605a05" class="outline-3">
<h3 id="orgb605a05"><span class="section-number-3">1.4</span> sqlite3_reset</h3>
</div>

<div id="outline-container-org62c2b29" class="outline-3">
<h3 id="org62c2b29"><span class="section-number-3">1.5</span> sqlite3_bind</h3>
</div>

<div id="outline-container-org4bf7aa9" class="outline-3">
<h3 id="org4bf7aa9"><span class="section-number-3">1.6</span> sqlite3_exec</h3>
</div>

<div id="outline-container-orga17f809" class="outline-3">
<h3 id="orga17f809"><span class="section-number-3">1.7</span> sqlite3_get_tables</h3>
</div>

<div id="outline-container-org0a71b35" class="outline-3">
<h3 id="org0a71b35"><span class="section-number-3">1.8</span> sqlite3_mprintf</h3>
</div>

<div id="outline-container-org5047a15" class="outline-3">
<h3 id="org5047a15"><span class="section-number-3">1.9</span> sqlite3_commit_hook</h3>
</div>

<div id="outline-container-org37adc7e" class="outline-3">
<h3 id="org37adc7e"><span class="section-number-3">1.10</span> sqlite3_rollback_hook</h3>
</div>

<div id="outline-container-orgb6b0b5a" class="outline-3">
<h3 id="orgb6b0b5a"><span class="section-number-3">1.11</span> sqlite3_busy_handler</h3>
</div>

<div id="outline-container-org4d08396" class="outline-3">
<h3 id="org4d08396"><span class="section-number-3">1.12</span> sqlite3_busy_timeout</h3>
</div>

<div id="outline-container-org6679fda" class="outline-3">
<h3 id="org6679fda"><span class="section-number-3">1.13</span> sqlite3_profile</h3>
</div>

<div id="outline-container-org2cbea35" class="outline-3">
<h3 id="org2cbea35"><span class="section-number-3">1.14</span> sqlite3_trace</h3>
</div>

<div id="outline-container-orgb2bc4eb" class="outline-3">
<h3 id="orgb2bc4eb"><span class="section-number-3">1.15</span> sqlite3_limit</h3>
</div>

<div id="outline-container-org84930ac" class="outline-3">
<h3 id="org84930ac"><span class="section-number-3">1.16</span> sqlite3_status</h3>
</div>

<div id="outline-container-org20b8366" class="outline-3">
<h3 id="org20b8366"><span class="section-number-3">1.17</span> sqlite3_db_status</h3>
</div>

<div id="outline-container-org8987847" class="outline-3">
<h3 id="org8987847"><span class="section-number-3">1.18</span> sqlite3_stmt_status</h3>
</div>

<div id="outline-container-orga15c257" class="outline-3">
<h3 id="orga15c257"><span class="section-number-3">1.19</span> sqlite3_config</h3>
</div>

<div id="outline-container-orge2b3ff3" class="outline-3">
<h3 id="orge2b3ff3"><span class="section-number-3">1.20</span> sqlite3_db_config</h3>
<div class="outline-text-3" id="text-1-20">
<ul class="org-ul">
<li>SQLITE_DBCONFIG_LOOKASIDE</li>
<li>SQLITE_DBCONFIG_ENABLE_FKEY</li>
<li>SQLITE_DBCONFIG_ENABLE_TRIGGER</li>
</ul>
</div>
</div>

<div id="outline-container-orgc120a92" class="outline-3">
<h3 id="orgc120a92"><span class="section-number-3">1.21</span> sqlite3_memory_used</h3>
</div>

<div id="outline-container-org3e3c407" class="outline-3">
<h3 id="org3e3c407"><span class="section-number-3">1.22</span> sqlite3_memory_highwater</h3>
</div>

<div id="outline-container-orgb58777c" class="outline-3">
<h3 id="orgb58777c"><span class="section-number-3">1.23</span> sqlite3_last_insert_rowid</h3>
</div>

<div id="outline-container-orgba29277" class="outline-3">
<h3 id="orgba29277"><span class="section-number-3">1.24</span> sqlite3_set_authorizer</h3>
</div>

<div id="outline-container-org557c4d7" class="outline-3">
<h3 id="org557c4d7"><span class="section-number-3">1.25</span> sqlite3_changes</h3>
</div>

<div id="outline-container-orgbede2e9" class="outline-3">
<h3 id="orgbede2e9"><span class="section-number-3">1.26</span> sqlite3_get_tables</h3>
</div>

<div id="outline-container-org4bd014e" class="outline-3">
<h3 id="org4bd014e"><span class="section-number-3">1.27</span> sqlite3_commit_hook</h3>
</div>

<div id="outline-container-orga7dc975" class="outline-3">
<h3 id="orga7dc975"><span class="section-number-3">1.28</span> sqlite3_rollback_hook</h3>
</div>

<div id="outline-container-org5fe6095" class="outline-3">
<h3 id="org5fe6095"><span class="section-number-3">1.29</span> sqlite3_update_hook</h3>
</div>

<div id="outline-container-orga77d57e" class="outline-3">
<h3 id="orga77d57e"><span class="section-number-3">1.30</span> sqlite3_release_memory</h3>
</div>

<div id="outline-container-orgde250a4" class="outline-3">
<h3 id="orgde250a4"><span class="section-number-3">1.31</span> sqlite3_db_release_memory</h3>
</div>

<div id="outline-container-org4cc689a" class="outline-3">
<h3 id="org4cc689a"><span class="section-number-3">1.32</span> sqlite3_soft_heap_limit64</h3>
</div>

<div id="outline-container-orgab4e45b" class="outline-3">
<h3 id="orgab4e45b"><span class="section-number-3">1.33</span> sqlite3_table_column_metadata</h3>
</div>

<div id="outline-container-org31dce3e" class="outline-3">
<h3 id="org31dce3e"><span class="section-number-3">1.34</span> blob 操作</h3>
<div class="outline-text-3" id="text-1-34">
</div>
<div id="outline-container-orgf4ac711" class="outline-4">
<h4 id="orgf4ac711"><span class="section-number-4">1.34.1</span> sqlite3_blob_open</h4>
</div>

<div id="outline-container-org8adee09" class="outline-4">
<h4 id="org8adee09"><span class="section-number-4">1.34.2</span> sqlite3_blob_read</h4>
</div>

<div id="outline-container-org4d04be9" class="outline-4">
<h4 id="org4d04be9"><span class="section-number-4">1.34.3</span> sqlite3_blob_write</h4>
</div>
</div>

<div id="outline-container-orgd183739" class="outline-3">
<h3 id="orgd183739"><span class="section-number-3">1.35</span> mutex</h3>
<div class="outline-text-3" id="text-1-35">
</div>
<div id="outline-container-org6f59bf7" class="outline-4">
<h4 id="org6f59bf7"><span class="section-number-4">1.35.1</span> sqlite3_mutex_alloc</h4>
</div>

<div id="outline-container-orgfbfd7cc" class="outline-4">
<h4 id="orgfbfd7cc"><span class="section-number-4">1.35.2</span> sqlite3_mutex_enter</h4>
</div>

<div id="outline-container-orgc935ad0" class="outline-4">
<h4 id="orgc935ad0"><span class="section-number-4">1.35.3</span> sqlite3_mutex_free</h4>
</div>

<div id="outline-container-org83f3085" class="outline-4">
<h4 id="org83f3085"><span class="section-number-4">1.35.4</span> sqlite3_mutex_try</h4>
</div>

<div id="outline-container-orgf02fdbc" class="outline-4">
<h4 id="orgf02fdbc"><span class="section-number-4">1.35.5</span> sqlite3_mutex_leave</h4>
</div>
</div>

<div id="outline-container-org26b3db3" class="outline-3">
<h3 id="org26b3db3"><span class="section-number-3">1.36</span> wal</h3>
<div class="outline-text-3" id="text-1-36">
</div>
<div id="outline-container-orgf8261c9" class="outline-4">
<h4 id="orgf8261c9"><span class="section-number-4">1.36.1</span> sqlite3_wal_hook</h4>
</div>

<div id="outline-container-org2f00f60" class="outline-4">
<h4 id="org2f00f60"><span class="section-number-4">1.36.2</span> sqlite3_wal_autocheckpoint</h4>
</div>

<div id="outline-container-org58b957f" class="outline-4">
<h4 id="org58b957f"><span class="section-number-4">1.36.3</span> sqlite3_wal_checkpoint_v2</h4>
<div class="outline-text-4" id="text-1-36-3">
<p>
<a href="http://sqlite.1065341.n5.nabble.com/Meaning-of-sqlite3-wal-checkpoint-v2-parameters-td30134.html">http://sqlite.1065341.n5.nabble.com/Meaning-of-sqlite3-wal-checkpoint-v2-parameters-td30134.html</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org6b57d4c" class="outline-3">
<h3 id="org6b57d4c"><span class="section-number-3">1.37</span> sqlite3_file_control</h3>
</div>

<div id="outline-container-org28e6b7d" class="outline-3">
<h3 id="org28e6b7d"><span class="section-number-3">1.38</span> sqlite3_finalize</h3>
<div class="outline-text-3" id="text-1-38">
<p>
在 auto-commit 模式下, sqlite3_finalize 相当于 commit 的作用:
</p>
<ul class="org-ul">
<li>释放锁</li>
<li>sync 日志与数据库</li>
</ul>
</div>
</div>

<div id="outline-container-orgc147ecd" class="outline-3">
<h3 id="orgc147ecd"><span class="section-number-3">1.39</span> extension api</h3>
<div class="outline-text-3" id="text-1-39">
</div>
<div id="outline-container-org1170a18" class="outline-4">
<h4 id="org1170a18"><span class="section-number-4">1.39.1</span> user defined functions</h4>
<div class="outline-text-4" id="text-1-39-1">
<p>
sqlite3_create_funtion
</p>
</div>
</div>

<div id="outline-container-org6c8f09c" class="outline-4">
<h4 id="org6c8f09c"><span class="section-number-4">1.39.2</span> user defined aggregates</h4>
</div>

<div id="outline-container-orgfb16b6d" class="outline-4">
<h4 id="orgfb16b6d"><span class="section-number-4">1.39.3</span> user define collations</h4>
<div class="outline-text-4" id="text-1-39-3">
<p>
sqlite3_create_collation
</p>
</div>
</div>
</div>

<div id="outline-container-org1171b23" class="outline-3">
<h3 id="org1171b23"><span class="section-number-3">1.40</span> sample code</h3>
<div class="outline-text-3" id="text-1-40">
<div class="org-src-container">
<pre class="src src-c"><span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;sqlite3.h&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;pthread.h&gt;</span>

<span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">query</span>(<span style="font-weight: bold; text-decoration: underline;">sqlite3</span> * <span style="font-weight: bold; font-style: italic;">db</span>) {
    <span style="font-weight: bold; text-decoration: underline;">sqlite3_stmt</span> *<span style="font-weight: bold; font-style: italic;">stmt</span>;
    <span style="font-weight: bold;">const</span> <span style="font-weight: bold; text-decoration: underline;">char</span> * <span style="font-weight: bold; font-style: italic;">tail</span>;
    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">rc</span>=sqlite3_prepare_v2(db,<span style="font-style: italic;">"select * from test"</span>, -1, &amp;stmt, &amp;tail);
    <span style="font-weight: bold;">if</span> (rc!=SQLITE_OK) {
        fprintf(<span style="font-style: italic;">"error prepare stmt: %s"</span>, sqlite3_errmsg(db));
        exit (1);
    }
    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">count</span>=0;
    rc=sqlite3_step(stmt);
    <span style="font-weight: bold;">while</span> (rc==SQLITE_ROW) {
        count++;
        rc=sqlite3_step(stmt);
    }
    sqlite3_finalize(stmt);
    printf(<span style="font-style: italic;">"query returns %d\n"</span>,count);
}

<span style="font-weight: bold; text-decoration: underline;">void</span> * <span style="font-weight: bold;">fun</span>(<span style="font-weight: bold; text-decoration: underline;">void</span> * <span style="font-weight: bold; font-style: italic;">args</span>) {
    query((<span style="font-weight: bold; text-decoration: underline;">sqlite3</span> *)args);
}


<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold;">main</span>(<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">argc</span>, <span style="font-weight: bold; text-decoration: underline;">char</span> *<span style="font-weight: bold; font-style: italic;">argv</span>[]) {
    sqlite3_config(SQLITE_CONFIG_SERIALIZED);
    <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">sqlite3_enable_shared_cache(SQLITE_OPEN_SHAREDCACHE);</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; text-decoration: underline;">sqlite3</span> *<span style="font-weight: bold; font-style: italic;">db</span>;
    <span style="font-weight: bold; text-decoration: underline;">sqlite3</span> *<span style="font-weight: bold; font-style: italic;">db2</span>;

    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">rc</span>=sqlite3_open_v2(<span style="font-style: italic;">"/home/sunway/test.db"</span>, &amp;db, SQLITE_OPEN_READWRITE, 0);

    <span style="font-weight: bold;">if</span> (rc) {
        printf(<span style="font-style: italic;">"can't open db: %s"</span>,sqlite3_errmsg(db));
        sqlite3_close(db);
        exit(1);
    }

    <span style="font-weight: bold; text-decoration: underline;">pthread_t</span> <span style="font-weight: bold; font-style: italic;">tid</span>;
    pthread_create(&amp;tid, <span style="font-weight: bold; text-decoration: underline;">NULL</span>, fun, db);

    query(db);
    pthread_join(tid, <span style="font-weight: bold; text-decoration: underline;">NULL</span>);
    <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">char * sql="insert into test values (\"test\",1)";</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">char * zerr;</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">rc=sqlite3_exec(db,sql,0,0,&amp;zerr);</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">if (rc!=SQLITE_OK) {</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; font-style: italic;">/*  </span><span style="font-weight: bold; font-style: italic;">printf("error when insert: %s", zerr);</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; font-style: italic;">/*  </span><span style="font-weight: bold; font-style: italic;">exit (1);</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold; font-style: italic;">/* </span><span style="font-weight: bold; font-style: italic;">}</span><span style="font-weight: bold; font-style: italic;"> */</span>
    <span style="font-weight: bold;">return</span> 0;
}

</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: 2017-09-09 Sat 00:00<br />
Last updated: 2021-09-16 Thu 11:06</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
         var d = document, s = d.createElement('script');
         s.src = '//sunwayforever-github-io.disqus.com/embed.js';
         s.setAttribute('data-timestamp', +new Date());
         (d.head || d.body).appendChild(s);
         })();
</script>
</div>
</body>
</html>
