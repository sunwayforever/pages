<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>FFT</title>

<link rel="stylesheet" type="text/css" href="/main.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../main.css" media="screen" />
<link rel="stylesheet" type="text/css" href="./main.css" media="screen" />
<link rel = "icon" href = "/icon.png"  type = "image/x-icon">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">FFT</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org000001d">1. FFT</a>
<ul>
<li><a href="#org0000001">1.1. dft</a></li>
<li><a href="#org0000004">1.2. idft</a></li>
<li><a href="#org000001a">1.3. fft</a>
<ul>
<li><a href="#org0000007">1.3.1. 对称性</a></li>
<li><a href="#org000000a">1.3.2. 分治</a></li>
<li><a href="#org000000d">1.3.3. 递归实现</a></li>
<li><a href="#org0000011">1.3.4. 非递归实现</a></li>
<li><a href="#org0000014">1.3.5. 使用 twiddle table</a></li>
<li><a href="#org0000017">1.3.6. 定点化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org000001d" class="outline-2">
<h2 id="org000001d"><span class="section-number-2">1.</span> FFT</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="https://github.com/sunwayforever/code/tree/master/hello_world/hello_fft">https://github.com/sunwayforever/code/tree/master/hello_world/hello_fft</a>
</p>
</div>

<div id="outline-container-org0000001" class="outline-3">
<h3 id="org0000001"><span class="section-number-3">1.1.</span> dft</h3>
<div class="outline-text-3" id="text-1-1">
<ol class="org-ol">
<li>dft 的计算公式为: \(X_k=\frac{2}{N}\sum_{n=0}^{N-1}x_n\cdot e^{-i*2\pi
   k\frac{n}{N}}\),  \(k \in 0 \to N-1\), k 表示不同频率</li>

<li><p>
其中的 \(e^{i\omega}\) 根据欧拉公式表示 \(cos(\omega)+i\cdot sin(\omega)\), 所以
dft 也可以写成 \(X_k=\frac{2}{N}\sum_{n=0}^{N-1}x_n\cdot(cos(-2\pi
   k\frac{n}{N})+i\cdot sin(-2\pi k \frac{n}{N})))\),
</p>

<p>
这里之所以用 \(-2\pi\) 而不是 \(2\pi\) 是有意让 sin 部分取负值, 后续计算 idft 会简单一点
</p></li>

<li>\(X_k\) 计算结果是复数的形式: \(X_k=amp\_of\_cos(k)+i \cdot amp\_of\_sin(k)\), 实际上表示两个数: cos(k) 和 sin(k) 的幅度</li>

<li>N 称为 dft 的点数, 通常是 2 的 n 次幂, 例如 128, 因为后面 fft 算法要求 N 是 2
的 n 次幂.</li>

<li><p>
dft 简单的说就是 x 与不同频率的 cos (和 sin) 在 N 个采样点的逐位相乘后再累加,
做为对应 cos (和 sin) 的幅度. 如下图所示:
</p>

<ul class="org-ul">
<li>红色是时域信号 x</li>
<li>蓝色是对应 cos(k=2)</li>
<li>绿色是对应 sin(k=5)</li>
<li>竖的灰线表示 N = 7, 灰线与红线和蓝线有 7 组交点, 两两相乘再累加, 即是
cos(k=2) 的幅度</li>
</ul>


<div id="org0000000" class="figure">
<p><img src="../extra/dft.png" alt="dft.png" />
</p>
</div></li>
</ol>

<p>
一个简单的 dft 的代码如下:
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-tree-sitter-hl-faceXtypeXbuiltin">void</span> <span class="org-tree-sitter-hl-faceXfunction">my_dft</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">in</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">tmp_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0.0f</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">tmp_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0.0f</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">k</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> k <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">k</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXvariable">tmp_r</span> <span class="org-tree-sitter-hl-faceXoperator">+=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>k<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2.0</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> k <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXvariable">tmp_i</span> <span class="org-tree-sitter-hl-faceXoperator">+=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>k<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2.0</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> k <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> tmp_r<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> tmp_i<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0000004" class="outline-3">
<h3 id="org0000004"><span class="section-number-3">1.2.</span> idft</h3>
<div class="outline-text-3" id="text-1-2">
<p>
idft 与 dft 反过来:
</p>

<p>
\(x_n=\frac{1}{N}\sum_{k=0}^{N-1}X_k\cdot e^{i\cdot 2\pi k\frac{n}{N}}\)
</p>

<p>
按照 dft 的定义, x 是许多个频率不同的 cos 和 sin 的叠加, 所以计算 idft 时直接把所有频率 (k) 对应的 cos 和 sin 叠加起来即可.
</p>

<p>
由于 \(X_k\) 用复数表示, 所以展开后相当于 \(amp\_of\_cos(k)*cos(2\pi k
\frac{n}{N})-amp\_of\_sin(k)*sin(2\pi k \frac{n}{N})\)
</p>

<p>
由于前面计算 dft 时 \(amp\_of\_sin(k)\) 实际是用的原值的对应的负值, 所以最终结果是正确的
</p>

<p>
简单的计算 idft 的代码:
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-tree-sitter-hl-faceXtypeXbuiltin">void</span> <span class="org-tree-sitter-hl-faceXfunction">my_idft</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">in</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">tmp</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0.0f</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">k</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> k <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">k</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXvariable">tmp</span> <span class="org-tree-sitter-hl-faceXoperator">+=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>k<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">2.0</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> k <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXcomment">/* &#36825;&#37324;&#30340; in[k].i &#26159;&#36127;&#20540;, &#25152;&#20197;&#29992;&#20943;&#21495;, &#20943;&#21495;&#23545;&#24212; i^2=-1 */</span>
            <span class="org-tree-sitter-hl-faceXvariable">tmp</span> <span class="org-tree-sitter-hl-faceXoperator">-=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>k<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">2.0</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> k <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> tmp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0.0f</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org000001a" class="outline-3">
<h3 id="org000001a"><span class="section-number-3">1.3.</span> fft</h3>
<div class="outline-text-3" id="text-1-3">
<p>
fft 是计算 dft 的快速算法, 复杂度为 \(O(n\log(n))\) , 而前面提到的简单 dft 算法的复杂度是 \(O(n^2)\)
</p>
</div>

<div id="outline-container-org0000007" class="outline-4">
<h4 id="org0000007"><span class="section-number-4">1.3.1.</span> 对称性</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
对称性是指 \(X_{k+N}=X_k\), 推导过程为:
</p>

<p>
\(X_k = \sum_{n=0}^{N-1}{x_n\cdot e^{-i2\pi{kn/N}}}\)
</p>

<p>
\(X_{k+N} = \sum_{n=0}^{N-1}{x_n\cdot e^{-i2\pi{(k+N)n/N}}} = \sum_{n=0}^{N-1}{x_n\cdot e^{-i2\pi{n}}\cdot e^{-i2\pi{kn/N}}}\)
</p>

<p>
\(e^{-i2\pi{n}} = 1\)
</p>

<p>
\(X_{k+N}=X_k\)
</p>
</div>
</div>

<div id="outline-container-org000000a" class="outline-4">
<h4 id="org000000a"><span class="section-number-4">1.3.2.</span> 分治</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
把 N 个点按奇偶分成两部分:
</p>

\begin{eqnarray*}
X_{k} &=& \sum_{n=0}^{N-1}{x_n\cdot e^{-i2\pi{kn/N}}} \\
      &=& \sum_{m=0}^{N/2-1}{x_{2m}\cdot e^{-i2\pi{k(2m)/N}}} + \sum_{m=0}^{N/2-1}{x_{2m+1}\cdot e^{-i2\pi{k(2m+1)/N}}} \\
      &=& \sum_{m=0}^{N/2-1}{x_{2m}\cdot e^{-i2\pi{km/(N/2)}}} + e^{-i2\pi{k/N}}\sum_{m=0}^{N/2-1}{x_{2m+1}\cdot e^{-i2\pi{km/(N/2)}}} \\
      &=& E+factor*O
\end{eqnarray*}

<p>
其中 \(E\) (even), \(O\) (odd) 是大小为 \(\frac{N}{2}\) 的 dft
</p>

<p>
对 \(E\) 和 \(O\) 来说, 由于 \(E_k=E_{k+\frac{N}{2}}\), 所以当计算 \(k>\frac{N}{2}\) 部分时, 可以复用前一次归并时计算好的 \(E_{k-\frac{N}{2}}\) 而不需要再重复计算 \(E_k\), 所以其复杂度是 \(O(n\log(n))\)
</p>
</div>
</div>

<div id="outline-container-org000000d" class="outline-4">
<h4 id="org000000d"><span class="section-number-4">1.3.3.</span> 递归实现</h4>
<div class="outline-text-4" id="text-1-3-3">
<div class="org-src-container">
<pre class="src src-C"><span class="org-tree-sitter-hl-faceXtypeXbuiltin">void</span> <span class="org-tree-sitter-hl-faceXfunction">my_recursive_fft</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">in</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">if</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point <span class="org-tree-sitter-hl-faceXoperator">==</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXkeyword">return</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">even_in</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">KISS_FFT_MALLOC</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span>n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>kiss_fft_cpx<span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">even_out</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">KISS_FFT_MALLOC</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span>n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>kiss_fft_cpx<span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">odd_in</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">KISS_FFT_MALLOC</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span>n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>kiss_fft_cpx<span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">odd_out</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">KISS_FFT_MALLOC</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span>n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>kiss_fft_cpx<span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXvariable">even_in</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXvariable">odd_in</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">my_recursive_fft</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> even_in<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> even_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">my_recursive_fft</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> odd_in<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> n_point <span class="org-tree-sitter-hl-faceXoperator">/</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-2</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-2</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r <span class="org-tree-sitter-hl-faceXoperator">-</span>
                   odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i <span class="org-tree-sitter-hl-faceXoperator">+</span>
                   odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

        <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-2</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-2</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">/</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r <span class="org-tree-sitter-hl-faceXoperator">-</span>
                         odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i <span class="org-tree-sitter-hl-faceXoperator">+</span>
                         odd_out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0000011" class="outline-4">
<h4 id="org0000011"><span class="section-number-4">1.3.4.</span> 非递归实现</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
由于分治时是以奇偶位置为准进行分组, 而不是像归并排序一样使用前半部/后半部, 导致分治时数据的分组会比较复杂.
</p>

<p>
可以事先交换数据的位置, 把它变成像归并排序一样使用前半部/后半部来分组, 以简化后续代码. 以 N = 8 为例:
</p>

<pre class="example" id="org0000010">
0 1   2 3   4 5   6 7
0 2   4 6 | 1 3   5 7
0 4 | 2 6 | 1 5 | 3 7
</pre>

<p>
最终交换后的数据为 `0 4 2 6 1 5 3 7`, 即:
</p>

<ol class="org-ol">
<li>0 和 4 进行第一步归并,</li>
<li>0,4 和 2,6 进行第二步归并</li>
<li>0,4,2,6 和 1,3,5,7 进行最后一次归并.</li>
</ol>

<p>
原 x[1] 位置应该放上 4, x[3] 应该放上 6, 通过观察发现 1 与 4, 3 与 6 的二进制是互为镜像的: 001 与 100, 011 与 110.
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-tree-sitter-hl-faceXkeyword">extern</span> <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_table</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXtypeXbuiltin">void</span> <span class="org-tree-sitter-hl-faceXfunction">my_fft</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">in</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">out</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">with_twiddle_table</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">rev</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXvariable">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXvariable">rev</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXcomment">/* </span><span class="org-tree-sitter-hl-faceXcomment"><span class="custom">NOTE</span></span><span class="org-tree-sitter-hl-faceXcomment">: rev &#29992;&#26469;&#20445;&#23384; bit &#21069;&#21518;&#32763;&#36716;&#21518;&#30340;&#20540;, &#28982;&#21518;&#26681;&#25454; rev &#23545;&#25968;&#25454;&#37325;&#25490; */</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">bit</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXfunctionXcall">log2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXvariable">rev</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">|</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span>i <span class="org-tree-sitter-hl-faceXoperator">&amp;</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>bit <span class="org-tree-sitter-hl-faceXoperator">-</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">memcpy</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>out<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> in<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXkeyword">if</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">])</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXvariable">tmp</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXvariable">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXvariable">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> tmp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> mid <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">*=</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">j</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> j <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">j</span> <span class="org-tree-sitter-hl-faceXoperator">+=</span> mid <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXvariable">j</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> j <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXvariable">even</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXvariable">odd</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">index</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXfunctionXcall">log2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0.0f</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0.0f</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXkeyword">if</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>with_twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span> <span class="org-tree-sitter-hl-faceXkeyword">else</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
                out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r <span class="org-tree-sitter-hl-faceXoperator">-</span>
                           odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i <span class="org-tree-sitter-hl-faceXoperator">+</span>
                           odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXkeyword">if</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>with_twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                    <span class="org-tree-sitter-hl-faceXcomment">/* printf( */</span>
                    <span class="org-tree-sitter-hl-faceXcomment">/*     "%f %f %f %f %f %f | ", even.r, odd.r,</span>
<span class="org-tree-sitter-hl-faceXcomment">                     * twiddle_factor_r, */</span>
                    <span class="org-tree-sitter-hl-faceXcomment">/*     odd.i, twiddle_factor_i, out[i].r); */</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                        twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                        twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span> <span class="org-tree-sitter-hl-faceXkeyword">else</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                    <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
                out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r <span class="org-tree-sitter-hl-faceXoperator">-</span>
                                           odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_i <span class="org-tree-sitter-hl-faceXoperator">+</span>
                                           odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0000014" class="outline-4">
<h4 id="org0000014"><span class="section-number-4">1.3.5.</span> 使用 twiddle table</h4>
<div class="outline-text-4" id="text-1-3-5">
<p>
\(even+factor*odd\) 使用的 factor 是一个常量, 可以提前计算出来, 叫做 twiddle table
</p>

<p>
产生 twiddle table:
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-tree-sitter-hl-faceXtypeXbuiltin">void</span> <span class="org-tree-sitter-hl-faceXfunction">generate_twiddle_table</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">bit</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXfunctionXcall">log2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>bit<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>bit<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> mid <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">*=</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">j</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> j <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">j</span> <span class="org-tree-sitter-hl-faceXoperator">+=</span> mid <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXvariable">j</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> j <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">index</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXfunctionXcall">log2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> i <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    <span class="org-tree-sitter-hl-faceXfunctionXcall">cos</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    <span class="org-tree-sitter-hl-faceXfunctionXcall">sin</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">-1</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">PI</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">/</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)(</span>twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)(</span>twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][</span>i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)(</span>twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)(</span>twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index<span class="org-tree-sitter-hl-faceXpunctuationXbracket">][(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXtype">FILE</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">fp</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXfunctionXcall">fopen</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXstring">"twiddle_table.c"</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"w"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"float twiddle_table[%d*%d] = {\n"</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> bit<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> bit <span class="org-tree-sitter-hl-faceXoperator">*</span> n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"%f,"</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">float</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span>twiddle_table<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">])</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"};\n"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

    <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"#include &lt;stdint.h&gt;\n"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"int32_t twiddle_table_fixed[%d*%d] = {\n"</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> bit<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> bit <span class="org-tree-sitter-hl-faceXoperator">*</span> n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"%d,"</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span>twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">])</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">fprintf</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXstring">"};\n"</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">fclose</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>fp<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org0000017" class="outline-4">
<h4 id="org0000017"><span class="section-number-4">1.3.6.</span> 定点化</h4>
<div class="outline-text-4" id="text-1-3-6">
<p>
由于 fft 是线性变换, 所以定点化还是比较简单的. 为了避免对 sin, cos 定点化, 可以利用 twiddle table, 提前把 twiddle table 的结果转换为定点 (参考前面的 twiddle_table_fixed)
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-tree-sitter-hl-faceXkeyword">extern</span> <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_table_fixed</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXkeyword">typedef</span> <span class="org-tree-sitter-hl-faceXkeyword">struct</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXpropertyXdefinition">r</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXpropertyXdefinition">i</span></span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx_fixed</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

<span class="org-tree-sitter-hl-faceXkeyword">static</span> <span class="org-tree-sitter-hl-faceXkeyword">inline</span> <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunction">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">a</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">b</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXkeyword">return</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int64_t</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span>a <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int64_t</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span>b<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>

<span class="org-tree-sitter-hl-faceXtypeXbuiltin">void</span> <span class="org-tree-sitter-hl-faceXfunction">my_fft_fixed</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariableXparameter">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">in</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariableXparameter">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">rev</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXvariable">n_point</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXvariable">rev</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">bit</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXfunctionXcall">log2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXvariable">rev</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">|</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">((</span>i <span class="org-tree-sitter-hl-faceXoperator">&amp;</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>bit <span class="org-tree-sitter-hl-faceXoperator">-</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXfunctionXcall">memcpy</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>out<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> in<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>in<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span><span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXkeyword">if</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">])</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx</span> <span class="org-tree-sitter-hl-faceXvariable">tmp</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXvariable">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXvariable">out</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>rev<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]]</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> tmp<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXcomment">/* convert out to fixed point */</span>
    <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx_fixed</span> <span class="org-tree-sitter-hl-faceXoperator">*</span><span class="org-tree-sitter-hl-faceXvariable">out_fixed</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
        <span class="org-tree-sitter-hl-faceXfunctionXcall">malloc</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>n_point <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXkeyword">sizeof</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>kiss_fft_cpx_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)(</span>out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)(</span>out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXnumber">1</span> <span class="org-tree-sitter-hl-faceXoperator">&lt;&lt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">))</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>

    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> mid <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">mid</span> <span class="org-tree-sitter-hl-faceXoperator">*=</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">j</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> j <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">j</span> <span class="org-tree-sitter-hl-faceXoperator">+=</span> mid <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
            <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXvariable">j</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> j <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
                <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx_fixed</span> <span class="org-tree-sitter-hl-faceXvariable">even</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXtype">kiss_fft_cpx_fixed</span> <span class="org-tree-sitter-hl-faceXvariable">odd</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">index</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXfunctionXcall">log2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXtypeXbuiltin">int32_t</span> <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> i <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">-</span>
                                 <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">+</span>
                                 <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_r</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
                <span class="org-tree-sitter-hl-faceXvariable">twiddle_factor_i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span>
                    twiddle_table_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>index <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXconstant">N</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">*</span> <span class="org-tree-sitter-hl-faceXnumber">2</span> <span class="org-tree-sitter-hl-faceXoperator">+</span> <span class="org-tree-sitter-hl-faceXnumber">1</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">+</span>
                                       <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">-</span>
                                       <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>

                out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i <span class="org-tree-sitter-hl-faceXoperator">+</span> mid<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> even<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">+</span>
                                       <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXoperator">+</span>
                                       <span class="org-tree-sitter-hl-faceXconstant"><span class="org-tree-sitter-hl-faceXfunctionXcall">MUL_Q15</span></span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span>odd<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">,</span> twiddle_factor_r<span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
            <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
        <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
    <span class="org-tree-sitter-hl-faceXcomment">/* convert back to float */</span>
    <span class="org-tree-sitter-hl-faceXkeyword">for</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">(</span><span class="org-tree-sitter-hl-faceXtypeXbuiltin">int</span> <span class="org-tree-sitter-hl-faceXvariable">i</span> <span class="org-tree-sitter-hl-faceXoperator">=</span> <span class="org-tree-sitter-hl-faceXnumber">0</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> i <span class="org-tree-sitter-hl-faceXoperator">&lt;</span> n_point<span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span> <span class="org-tree-sitter-hl-faceXvariable">i</span><span class="org-tree-sitter-hl-faceXoperator">++</span><span class="org-tree-sitter-hl-faceXpunctuationXbracket">)</span> <span class="org-tree-sitter-hl-faceXpunctuationXbracket">{</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">r</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">r</span> <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
        out<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty"><span class="org-tree-sitter-hl-faceXvariable">i</span></span> <span class="org-tree-sitter-hl-faceXoperator">=</span> out_fixed<span class="org-tree-sitter-hl-faceXpunctuationXbracket">[</span>i<span class="org-tree-sitter-hl-faceXpunctuationXbracket">]</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">.</span><span class="org-tree-sitter-hl-faceXproperty">i</span> <span class="org-tree-sitter-hl-faceXoperator">&gt;&gt;</span> <span class="org-tree-sitter-hl-faceXnumber">15</span><span class="org-tree-sitter-hl-faceXpunctuationXdelimiter">;</span>
    <span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
<span class="org-tree-sitter-hl-faceXpunctuationXbracket">}</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: 2022-09-29 Thu 22:01<br />
Last updated: 2022-09-30 Fri 11:22</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
         var d = document, s = d.createElement('script');
         s.src = '//sunwayforever-github-io.disqus.com/embed.js';
         s.setAttribute('data-timestamp', +new Date());
         (d.head || d.body).appendChild(s);
         })();
</script>
</div>
</body>
</html>
