<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-14 五 19:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DMS Program</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Wei Sun (孙伟)" />
<link rel="stylesheet" type="text/css" href="../stylesheets/main.css" media="screen" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">DMS Program</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf2e97ce">1. DMS Program</a>
<ul>
<li><a href="#orgb9ff8f6">1.1. INU</a>
<ul>
<li><a href="#orgc76fd0d">1.1.1. Host SDK</a></li>
<li><a href="#org44c3820">1.1.2. Firmware SDK (FDK)</a></li>
</ul>
</li>
<li><a href="#org836aa93">1.2. 算法</a>
<ul>
<li><a href="#org235ff84">1.2.1. face detection (mediapipe)</a></li>
<li><a href="#orgb9de5ac">1.2.2. face landmark (mediapipe)</a></li>
<li><a href="#org1b592ad">1.2.3. iris detection (mediapipe)</a></li>
<li><a href="#org135a789">1.2.4. palm detection &amp; gesture detection (mediapipe)</a></li>
<li><a href="#orgbc0e6f7">1.2.5. face recognition</a></li>
<li><a href="#org1a45df8">1.2.6. 自己实现和训练上述所有模型</a></li>
<li><a href="#org9687bce">1.2.7. 在终端设备上运行上述所有模型的 inference</a></li>
</ul>
</li>
<li><a href="#org344ab68">1.3. 应用</a>
<ul>
<li><a href="#org36be1a8">1.3.1. 算法 SDK</a></li>
<li><a href="#org0722cbc">1.3.2. 疲劳检测 (drowsiness detection)</a></li>
<li><a href="#orge00ab5c">1.3.3. 分心检测 与 gaze region detection</a></li>
<li><a href="#org9db7732">1.3.4. 驾驶员识别</a></li>
<li><a href="#org70818a6">1.3.5. 驾驶员手势</a></li>
<li><a href="#orga198b67">1.3.6. animoji demo (face motion capture)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgf2e97ce" class="outline-2">
<h2 id="orgf2e97ce"><span class="section-number-2">1</span> DMS Program</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgb9ff8f6" class="outline-3">
<h3 id="orgb9ff8f6"><span class="section-number-3">1.1</span> INU</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orgc76fd0d" class="outline-4">
<h4 id="orgc76fd0d"><span class="section-number-4">1.1.1</span> Host SDK</h4>
<div class="outline-text-4" id="text-1-1-1">
</div>
<div id="outline-container-orgf26c01c" class="outline-5">
<h5 id="orgf26c01c"><span class="section-number-5">1.1.1.1</span> webcam stream</h5>
<div class="outline-text-5" id="text-1-1-1-1">
<p>
现在已经试过了可以通过 webcam stream 把 INU 当作一个普通摄像头使用.
用 c++ 写的 face detection demo 可以正常工作
</p>
</div>
</div>

<div id="outline-container-org77ffc7e" class="outline-5">
<h5 id="org77ffc7e"><span class="section-number-5">1.1.1.2</span> depth stream</h5>
<div class="outline-text-5" id="text-1-1-1-2">
<p>
拿到 depth 数据 <a href="#orga198b67">animoji demo (face motion capture)</a>
</p>
</div>
</div>

<div id="outline-container-org09c581e" class="outline-5">
<h5 id="org09c581e"><span class="section-number-5">1.1.1.3</span> NN stream</h5>
<div class="outline-text-5" id="text-1-1-1-3">
<p>
如果需要在 INU 上跑 NN, 则需要使用 NN stream
</p>
</div>

<ol class="org-ol">
<li><a id="orga0fa039"></a>转换模型<br />
<div class="outline-text-6" id="text-1-1-1-3-1">
<p>
tflite 模型需要 INU 转换成它自己的格式才能使用. INU 已经转换过一个, 可以看到转换工具不怎么健壮, 容易出错, 转换后的正确性也需要验证
</p>
</div>
</li>

<li><a id="org73d53a8"></a>使用 NN stream<br /></li>
</ol>
</div>
</div>

<div id="outline-container-org44c3820" class="outline-4">
<h4 id="org44c3820"><span class="section-number-4">1.1.2</span> Firmware SDK (FDK)</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
<div id="outline-container-orgdbf350d" class="outline-5">
<h5 id="orgdbf350d"><span class="section-number-5">1.1.2.1</span> graph</h5>
<div class="outline-text-5" id="text-1-1-2-1">
<p>
有时需要多个 NN 模型在 INU 上配合执行, 例如
</p>

<ol class="org-ol">
<li>face detection 模型执行后获得人脸 ROI</li>
<li>face landmark 模型根据人脸 ROI 获得 landmark 信息, 同时获得 iris ROI</li>
<li>iris detection 根据 iris ROI 获得 iris landmark 信息</li>
</ol>

<p>
上面三个模型一起工作时, 需要通过 INU graph 描述成一个 graph, 或 pipeline, 各个模型前后需要的数据处理需要通过 FDK 在 INU 内部完成 (而不是在 host 完成)
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org836aa93" class="outline-3">
<h3 id="org836aa93"><span class="section-number-3">1.2</span> 算法</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org235ff84" class="outline-4">
<h4 id="org235ff84"><span class="section-number-4">1.2.1</span> face detection (mediapipe)</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
检测人脸
</p>
</div>
</div>

<div id="outline-container-orgb9de5ac" class="outline-4">
<h4 id="orgb9de5ac"><span class="section-number-4">1.2.2</span> face landmark (mediapipe)</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
检测人脸上的关键点, 可以用来
</p>

<ol class="org-ol">
<li>获得人脸的姿态 (head pose detection)</li>
<li>嘴的开闭</li>
<li>配合 depth 信息, 对人脸进行 3d 建模 <a href="#orga198b67">animoji demo (face motion capture)</a></li>
</ol>
</div>

<div id="outline-container-orgee6db47" class="outline-5">
<h5 id="orgee6db47"><span class="section-number-5">1.2.2.1</span> head pose detection</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<p>
现在 head pose detection 不太准确
</p>
</div>
</div>
</div>

<div id="outline-container-org1b592ad" class="outline-4">
<h4 id="org1b592ad"><span class="section-number-4">1.2.3</span> iris detection (mediapipe)</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
检测眼部的 landmark, 可以用来
</p>

<ol class="org-ol">
<li>检测是否闭眼</li>
<li>检测眼球的方向 (gaze detection)</li>
</ol>
</div>

<div id="outline-container-org68875b8" class="outline-5">
<h5 id="org68875b8"><span class="section-number-5">1.2.3.1</span> gaze detection</h5>
</div>
</div>

<div id="outline-container-org135a789" class="outline-4">
<h4 id="org135a789"><span class="section-number-4">1.2.4</span> palm detection &amp; gesture detection (mediapipe)</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
检测手掌和手势
</p>
</div>
</div>

<div id="outline-container-orgbc0e6f7" class="outline-4">
<h4 id="orgbc0e6f7"><span class="section-number-4">1.2.5</span> face recognition</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
识别不同的人, face embedding 可以很好的支持这个功能 <a href="#org9db7732">驾驶员识别</a>
</p>
</div>
</div>

<div id="outline-container-org1a45df8" class="outline-4">
<h4 id="org1a45df8"><span class="section-number-4">1.2.6</span> 自己实现和训练上述所有模型</h4>
<div class="outline-text-4" id="text-1-2-6">
<p>
上述算法有些使用的是 google 开放的 mediapipe 里提供的 tflite 模型, 我们需要自己去实现和训练这些模型, 避免被 mediapipe 无法解决的问题 block
</p>
</div>
</div>

<div id="outline-container-org9687bce" class="outline-4">
<h4 id="org9687bce"><span class="section-number-4">1.2.7</span> 在终端设备上运行上述所有模型的 inference</h4>
<div class="outline-text-4" id="text-1-2-7">
<p>
inference 时最终我们需要跑在 710 或 INU 这样的设备上, 所以需要把上面所有的模型用
c++ 重写
</p>
</div>
</div>
</div>

<div id="outline-container-org344ab68" class="outline-3">
<h3 id="org344ab68"><span class="section-number-3">1.3</span> 应用</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org36be1a8" class="outline-4">
<h4 id="org36be1a8"><span class="section-number-4">1.3.1</span> 算法 SDK</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
上面的算法需要提供统一的服务, 方便应用使用. 主要的问题是需要屏蔽各种硬件/软件的差异:
</p>

<p>
硬件方面: CPU, GPU, NN 加速器. 软件方面: python, c++, linux 等
</p>

<p>
目前的 target 是: linux, c++, tflite on CPU, 后续会把 tflite on CPU 换成 710 或
INU 的 NN 加速器
</p>
</div>
</div>


<div id="outline-container-org0722cbc" class="outline-4">
<h4 id="org0722cbc"><span class="section-number-4">1.3.2</span> 疲劳检测 (drowsiness detection)</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
face landrmark, head pose detection, iris landmark 等可以检测眨眼, 哈欠, 点头等
</p>
</div>
</div>

<div id="outline-container-orge00ab5c" class="outline-4">
<h4 id="orge00ab5c"><span class="section-number-4">1.3.3</span> 分心检测 与 gaze region detection</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
基于 head pose detection 和 gaze detection
</p>
</div>
</div>

<div id="outline-container-org9db7732" class="outline-4">
<h4 id="org9db7732"><span class="section-number-4">1.3.4</span> 驾驶员识别</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
基于 face recognition, 驾驶员需要进行一次 enroll 动作, 后续就可以识别这个人了.
</p>
</div>
</div>

<div id="outline-container-org70818a6" class="outline-4">
<h4 id="org70818a6"><span class="section-number-4">1.3.5</span> 驾驶员手势</h4>
<div class="outline-text-4" id="text-1-3-5">
<p>
基于 gesture detection
</p>
</div>
</div>

<div id="outline-container-orga198b67" class="outline-4">
<h4 id="orga198b67"><span class="section-number-4">1.3.6</span> animoji demo (face motion capture)</h4>
<div class="outline-text-4" id="text-1-3-6">
<p>
综合 face landmark, head pose, gaze 和 depth 信息, 通过 blender 对人脸进行 3d 建模
</p>
</div>

<div id="outline-container-org0853edb" class="outline-5">
<h5 id="org0853edb"><span class="section-number-5">1.3.6.1</span> INU python 封装</h5>
<div class="outline-text-5" id="text-1-3-6-1">
<p>
blender 只支持 python 做为脚本语言, 所以需要把 INU 的 Host SDK 中与 webcam
stream, depth stream 相关的接口用 python 封装一遍.
</p>

<p>
如果用 realsense 可以省掉这部分工作量, 因为 realsense 本身提供了 python binding
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: 2021-01-13 三 00:00<br />
Last updated: 2021-09-16 四 11:06</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

           <div id="disqus_thread"></div>
           <script>

           (function() { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = '//sunwayforever-github-io.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                    })();
           </script>
</div>
</body>
</html>
