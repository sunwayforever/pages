<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-22 Sat 11:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Openwrt on Phicomm N1</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Wei Sun (孙伟)" />
<link rel="stylesheet" type="text/css" href="/main.css" media="screen" />
<link rel = "icon" href = "/icon.png"  type = "image/x-icon">
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Openwrt on Phicomm N1</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc3b7039">1. Openwrt on Phicomm N1</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc3b7039" class="outline-2">
<h2 id="orgc3b7039"><span class="section-number-2">1</span> Openwrt on Phicomm N1</h2>
<div class="outline-text-2" id="text-1">
<pre class="example" id="org33c29f5">
$&gt; ip link set eth0 promisc on

# 假设主路由器地址为 192.168.2.1, 网段为 192.168.2.0/24
$&gt; docker network create -d macvlan --subnet=192.168.2.0/24 --gateway=192.168.2.1 -o parent=eth0 macnet

$&gt; docker pull buddyfly/openwrt-aarch64:latest

$&gt; docker run --name openwrt --restart always -d --network macnet --privileged -v /media/download:/download buddyfly/openwrt-aarch64:latest /sbin/init

$&gt; docker exec -it openwrt sh

$ [docker] &gt; vi /etc/config/network

修改 option ipaddr, 例如 '192.168.2.100' 做为 openwrt 的地址, 需要与前面配置的 macnet 在同一网段

config interface 'lan'
        option type 'bridge'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.2.100'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '192.168.2.1'
        option dns '8.8.8.8'

$ [docker] &gt; /etc/init.d/network restart

# 修改 root 密码
$ [docker] &gt; passwd

$ [docker] exit

$&gt; chrome http://192.168.2.100

# 通过 openwrt web 中配置 passwall, 配置 v2ray client, 并且配置 passwall 做为shadowsocks server. 
# 同时在主路由器配置 shadowsocks client, 这样主路由器就可以通过 passwall 的 shadowsocks 间接访问 v2ray 服务了.
# 不需要再额外配置透明代理的工作 (主路由上的 shadowsocks client 会自动配置透明代理)

# 之所以不在主路由器直接用 v2ray 时因为主路由器没有足够的空间安装 v2ray...

</pre>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="author">Author: sunway (sunwayforever@gmail.com)<br />
Date: 2022-01-21 Fri 00:00<br />
Last updated: 2022-01-22 Sat 11:06</p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
<br />

<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
         var d = document, s = d.createElement('script');
         s.src = '//sunwayforever-github-io.disqus.com/embed.js';
         s.setAttribute('data-timestamp', +new Date());
         (d.head || d.body).appendChild(s);
         })();
</script>
</div>
</body>
</html>
